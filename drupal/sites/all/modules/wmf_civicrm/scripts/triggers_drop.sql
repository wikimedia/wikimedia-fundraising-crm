DELIMITER //
DROP TRIGGER IF EXISTS civicrm_acl_before_insert //
DROP TRIGGER IF EXISTS civicrm_acl_before_update //
DROP TRIGGER IF EXISTS civicrm_acl_before_delete //
DROP TRIGGER IF EXISTS civicrm_acl_after_insert //
DROP TRIGGER IF EXISTS civicrm_acl_after_update //
DROP TRIGGER IF EXISTS civicrm_acl_after_delete //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_before_insert //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_before_update //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_before_delete //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_after_insert //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_after_update //
DROP TRIGGER IF EXISTS civicrm_acl_entity_role_after_delete //
DROP TRIGGER IF EXISTS civicrm_action_schedule_before_insert //
DROP TRIGGER IF EXISTS civicrm_action_schedule_before_update //
DROP TRIGGER IF EXISTS civicrm_action_schedule_before_delete //
DROP TRIGGER IF EXISTS civicrm_action_schedule_after_insert //
DROP TRIGGER IF EXISTS civicrm_action_schedule_after_update //
DROP TRIGGER IF EXISTS civicrm_action_schedule_after_delete //
DROP TRIGGER IF EXISTS civicrm_activity_before_insert //
DROP TRIGGER IF EXISTS civicrm_activity_before_update //
DROP TRIGGER IF EXISTS civicrm_activity_before_delete //
DROP TRIGGER IF EXISTS civicrm_activity_after_insert //
DROP TRIGGER IF EXISTS civicrm_activity_after_update //
DROP TRIGGER IF EXISTS civicrm_activity_after_delete //
DROP TRIGGER IF EXISTS civicrm_activity_contact_before_insert //
DROP TRIGGER IF EXISTS civicrm_activity_contact_before_update //
DROP TRIGGER IF EXISTS civicrm_activity_contact_before_delete //
DROP TRIGGER IF EXISTS civicrm_activity_contact_after_insert //
DROP TRIGGER IF EXISTS civicrm_activity_contact_after_update //
DROP TRIGGER IF EXISTS civicrm_activity_contact_after_delete //
DROP TRIGGER IF EXISTS civicrm_address_before_insert //
DROP TRIGGER IF EXISTS civicrm_address_before_update //
DROP TRIGGER IF EXISTS civicrm_address_before_delete //
DROP TRIGGER IF EXISTS civicrm_address_after_insert //
DROP TRIGGER IF EXISTS civicrm_address_after_update //
DROP TRIGGER IF EXISTS civicrm_address_after_delete //
DROP TRIGGER IF EXISTS civicrm_address_format_before_insert //
DROP TRIGGER IF EXISTS civicrm_address_format_before_update //
DROP TRIGGER IF EXISTS civicrm_address_format_before_delete //
DROP TRIGGER IF EXISTS civicrm_address_format_after_insert //
DROP TRIGGER IF EXISTS civicrm_address_format_after_update //
DROP TRIGGER IF EXISTS civicrm_address_format_after_delete //
DROP TRIGGER IF EXISTS civicrm_afform_submission_before_insert //
DROP TRIGGER IF EXISTS civicrm_afform_submission_before_update //
DROP TRIGGER IF EXISTS civicrm_afform_submission_before_delete //
DROP TRIGGER IF EXISTS civicrm_afform_submission_after_insert //
DROP TRIGGER IF EXISTS civicrm_afform_submission_after_update //
DROP TRIGGER IF EXISTS civicrm_afform_submission_after_delete //
DROP TRIGGER IF EXISTS civicrm_batch_before_insert //
DROP TRIGGER IF EXISTS civicrm_batch_before_update //
DROP TRIGGER IF EXISTS civicrm_batch_before_delete //
DROP TRIGGER IF EXISTS civicrm_batch_after_insert //
DROP TRIGGER IF EXISTS civicrm_batch_after_update //
DROP TRIGGER IF EXISTS civicrm_batch_after_delete //
DROP TRIGGER IF EXISTS civicrm_campaign_before_insert //
DROP TRIGGER IF EXISTS civicrm_campaign_before_update //
DROP TRIGGER IF EXISTS civicrm_campaign_before_delete //
DROP TRIGGER IF EXISTS civicrm_campaign_after_insert //
DROP TRIGGER IF EXISTS civicrm_campaign_after_update //
DROP TRIGGER IF EXISTS civicrm_campaign_after_delete //
DROP TRIGGER IF EXISTS civicrm_campaign_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_campaign_group_before_update //
DROP TRIGGER IF EXISTS civicrm_campaign_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_campaign_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_campaign_group_after_update //
DROP TRIGGER IF EXISTS civicrm_campaign_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_case_before_insert //
DROP TRIGGER IF EXISTS civicrm_case_before_update //
DROP TRIGGER IF EXISTS civicrm_case_before_delete //
DROP TRIGGER IF EXISTS civicrm_case_after_insert //
DROP TRIGGER IF EXISTS civicrm_case_after_update //
DROP TRIGGER IF EXISTS civicrm_case_after_delete //
DROP TRIGGER IF EXISTS civicrm_case_activity_before_insert //
DROP TRIGGER IF EXISTS civicrm_case_activity_before_update //
DROP TRIGGER IF EXISTS civicrm_case_activity_before_delete //
DROP TRIGGER IF EXISTS civicrm_case_activity_after_insert //
DROP TRIGGER IF EXISTS civicrm_case_activity_after_update //
DROP TRIGGER IF EXISTS civicrm_case_activity_after_delete //
DROP TRIGGER IF EXISTS civicrm_case_contact_before_insert //
DROP TRIGGER IF EXISTS civicrm_case_contact_before_update //
DROP TRIGGER IF EXISTS civicrm_case_contact_before_delete //
DROP TRIGGER IF EXISTS civicrm_case_contact_after_insert //
DROP TRIGGER IF EXISTS civicrm_case_contact_after_update //
DROP TRIGGER IF EXISTS civicrm_case_contact_after_delete //
DROP TRIGGER IF EXISTS civicrm_case_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_case_type_before_update //
DROP TRIGGER IF EXISTS civicrm_case_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_case_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_case_type_after_update //
DROP TRIGGER IF EXISTS civicrm_case_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_component_before_insert //
DROP TRIGGER IF EXISTS civicrm_component_before_update //
DROP TRIGGER IF EXISTS civicrm_component_before_delete //
DROP TRIGGER IF EXISTS civicrm_component_after_insert //
DROP TRIGGER IF EXISTS civicrm_component_after_update //
DROP TRIGGER IF EXISTS civicrm_component_after_delete //
DROP TRIGGER IF EXISTS civicrm_contact_before_insert //
DROP TRIGGER IF EXISTS civicrm_contact_before_update //
DROP TRIGGER IF EXISTS civicrm_contact_before_delete //
DROP TRIGGER IF EXISTS civicrm_contact_after_insert //
DROP TRIGGER IF EXISTS civicrm_contact_after_update //
DROP TRIGGER IF EXISTS civicrm_contact_after_delete //
DROP TRIGGER IF EXISTS civicrm_contact_layout_before_insert //
DROP TRIGGER IF EXISTS civicrm_contact_layout_before_update //
DROP TRIGGER IF EXISTS civicrm_contact_layout_before_delete //
DROP TRIGGER IF EXISTS civicrm_contact_layout_after_insert //
DROP TRIGGER IF EXISTS civicrm_contact_layout_after_update //
DROP TRIGGER IF EXISTS civicrm_contact_layout_after_delete //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_before_insert //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_before_update //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_before_delete //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_after_insert //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_after_update //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_after_delete //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_before_insert //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_before_update //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_before_delete //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_after_insert //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_after_update //
DROP TRIGGER IF EXISTS civicrm_contact_name_pair_family_after_delete //
DROP TRIGGER IF EXISTS civicrm_contact_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_contact_type_before_update //
DROP TRIGGER IF EXISTS civicrm_contact_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_contact_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_contact_type_after_update //
DROP TRIGGER IF EXISTS civicrm_contact_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_page_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_page_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_page_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_page_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_page_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_page_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_product_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_product_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_product_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_product_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_product_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_product_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_recur_smashpig_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_soft_after_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_before_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_before_update //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_before_delete //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_after_insert //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_after_update //
DROP TRIGGER IF EXISTS civicrm_contribution_widget_after_delete //
DROP TRIGGER IF EXISTS civicrm_country_before_insert //
DROP TRIGGER IF EXISTS civicrm_country_before_update //
DROP TRIGGER IF EXISTS civicrm_country_before_delete //
DROP TRIGGER IF EXISTS civicrm_country_after_insert //
DROP TRIGGER IF EXISTS civicrm_country_after_update //
DROP TRIGGER IF EXISTS civicrm_country_after_delete //
DROP TRIGGER IF EXISTS civicrm_county_before_insert //
DROP TRIGGER IF EXISTS civicrm_county_before_update //
DROP TRIGGER IF EXISTS civicrm_county_before_delete //
DROP TRIGGER IF EXISTS civicrm_county_after_insert //
DROP TRIGGER IF EXISTS civicrm_county_after_update //
DROP TRIGGER IF EXISTS civicrm_county_after_delete //
DROP TRIGGER IF EXISTS civicrm_currency_before_insert //
DROP TRIGGER IF EXISTS civicrm_currency_before_update //
DROP TRIGGER IF EXISTS civicrm_currency_before_delete //
DROP TRIGGER IF EXISTS civicrm_currency_after_insert //
DROP TRIGGER IF EXISTS civicrm_currency_after_update //
DROP TRIGGER IF EXISTS civicrm_currency_after_delete //
DROP TRIGGER IF EXISTS civicrm_custom_field_before_insert //
DROP TRIGGER IF EXISTS civicrm_custom_field_before_update //
DROP TRIGGER IF EXISTS civicrm_custom_field_before_delete //
DROP TRIGGER IF EXISTS civicrm_custom_field_after_insert //
DROP TRIGGER IF EXISTS civicrm_custom_field_after_update //
DROP TRIGGER IF EXISTS civicrm_custom_field_after_delete //
DROP TRIGGER IF EXISTS civicrm_custom_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_custom_group_before_update //
DROP TRIGGER IF EXISTS civicrm_custom_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_custom_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_custom_group_after_update //
DROP TRIGGER IF EXISTS civicrm_custom_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_cxn_before_insert //
DROP TRIGGER IF EXISTS civicrm_cxn_before_update //
DROP TRIGGER IF EXISTS civicrm_cxn_before_delete //
DROP TRIGGER IF EXISTS civicrm_cxn_after_insert //
DROP TRIGGER IF EXISTS civicrm_cxn_after_update //
DROP TRIGGER IF EXISTS civicrm_cxn_after_delete //
DROP TRIGGER IF EXISTS civicrm_dashboard_before_insert //
DROP TRIGGER IF EXISTS civicrm_dashboard_before_update //
DROP TRIGGER IF EXISTS civicrm_dashboard_before_delete //
DROP TRIGGER IF EXISTS civicrm_dashboard_after_insert //
DROP TRIGGER IF EXISTS civicrm_dashboard_after_update //
DROP TRIGGER IF EXISTS civicrm_dashboard_after_delete //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_before_insert //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_before_update //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_before_delete //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_after_insert //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_after_update //
DROP TRIGGER IF EXISTS civicrm_dashboard_contact_after_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_before_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_before_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_before_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_after_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_after_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_exception_after_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_before_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_before_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_before_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_after_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_after_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_after_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_before_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_after_update //
DROP TRIGGER IF EXISTS civicrm_dedupe_rule_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_discount_before_insert //
DROP TRIGGER IF EXISTS civicrm_discount_before_update //
DROP TRIGGER IF EXISTS civicrm_discount_before_delete //
DROP TRIGGER IF EXISTS civicrm_discount_after_insert //
DROP TRIGGER IF EXISTS civicrm_discount_after_update //
DROP TRIGGER IF EXISTS civicrm_discount_after_delete //
DROP TRIGGER IF EXISTS civicrm_domain_before_insert //
DROP TRIGGER IF EXISTS civicrm_domain_before_update //
DROP TRIGGER IF EXISTS civicrm_domain_before_delete //
DROP TRIGGER IF EXISTS civicrm_domain_after_insert //
DROP TRIGGER IF EXISTS civicrm_domain_after_update //
DROP TRIGGER IF EXISTS civicrm_domain_after_delete //
DROP TRIGGER IF EXISTS civicrm_email_before_insert //
DROP TRIGGER IF EXISTS civicrm_email_before_update //
DROP TRIGGER IF EXISTS civicrm_email_before_delete //
DROP TRIGGER IF EXISTS civicrm_email_after_insert //
DROP TRIGGER IF EXISTS civicrm_email_after_update //
DROP TRIGGER IF EXISTS civicrm_email_after_delete //
DROP TRIGGER IF EXISTS civicrm_entity_batch_before_insert //
DROP TRIGGER IF EXISTS civicrm_entity_batch_before_update //
DROP TRIGGER IF EXISTS civicrm_entity_batch_before_delete //
DROP TRIGGER IF EXISTS civicrm_entity_batch_after_insert //
DROP TRIGGER IF EXISTS civicrm_entity_batch_after_update //
DROP TRIGGER IF EXISTS civicrm_entity_batch_after_delete //
DROP TRIGGER IF EXISTS civicrm_entity_file_before_insert //
DROP TRIGGER IF EXISTS civicrm_entity_file_before_update //
DROP TRIGGER IF EXISTS civicrm_entity_file_before_delete //
DROP TRIGGER IF EXISTS civicrm_entity_file_after_insert //
DROP TRIGGER IF EXISTS civicrm_entity_file_after_update //
DROP TRIGGER IF EXISTS civicrm_entity_file_after_delete //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_before_insert //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_before_update //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_before_delete //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_after_insert //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_after_update //
DROP TRIGGER IF EXISTS civicrm_entity_financial_account_after_delete //
DROP TRIGGER IF EXISTS civicrm_entity_tag_before_insert //
DROP TRIGGER IF EXISTS civicrm_entity_tag_before_update //
DROP TRIGGER IF EXISTS civicrm_entity_tag_before_delete //
DROP TRIGGER IF EXISTS civicrm_entity_tag_after_insert //
DROP TRIGGER IF EXISTS civicrm_entity_tag_after_update //
DROP TRIGGER IF EXISTS civicrm_entity_tag_after_delete //
DROP TRIGGER IF EXISTS civicrm_event_before_insert //
DROP TRIGGER IF EXISTS civicrm_event_before_update //
DROP TRIGGER IF EXISTS civicrm_event_before_delete //
DROP TRIGGER IF EXISTS civicrm_event_after_insert //
DROP TRIGGER IF EXISTS civicrm_event_after_update //
DROP TRIGGER IF EXISTS civicrm_event_after_delete //
DROP TRIGGER IF EXISTS civicrm_event_carts_before_insert //
DROP TRIGGER IF EXISTS civicrm_event_carts_before_update //
DROP TRIGGER IF EXISTS civicrm_event_carts_before_delete //
DROP TRIGGER IF EXISTS civicrm_event_carts_after_insert //
DROP TRIGGER IF EXISTS civicrm_event_carts_after_update //
DROP TRIGGER IF EXISTS civicrm_event_carts_after_delete //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_before_insert //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_before_update //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_before_delete //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_after_insert //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_after_update //
DROP TRIGGER IF EXISTS civicrm_events_in_carts_after_delete //
DROP TRIGGER IF EXISTS civicrm_extension_before_insert //
DROP TRIGGER IF EXISTS civicrm_extension_before_update //
DROP TRIGGER IF EXISTS civicrm_extension_before_delete //
DROP TRIGGER IF EXISTS civicrm_extension_after_insert //
DROP TRIGGER IF EXISTS civicrm_extension_after_update //
DROP TRIGGER IF EXISTS civicrm_extension_after_delete //
DROP TRIGGER IF EXISTS civicrm_file_before_insert //
DROP TRIGGER IF EXISTS civicrm_file_before_update //
DROP TRIGGER IF EXISTS civicrm_file_before_delete //
DROP TRIGGER IF EXISTS civicrm_file_after_insert //
DROP TRIGGER IF EXISTS civicrm_file_after_update //
DROP TRIGGER IF EXISTS civicrm_file_after_delete //
DROP TRIGGER IF EXISTS civicrm_financial_account_before_insert //
DROP TRIGGER IF EXISTS civicrm_financial_account_before_update //
DROP TRIGGER IF EXISTS civicrm_financial_account_before_delete //
DROP TRIGGER IF EXISTS civicrm_financial_account_after_insert //
DROP TRIGGER IF EXISTS civicrm_financial_account_after_update //
DROP TRIGGER IF EXISTS civicrm_financial_account_after_delete //
DROP TRIGGER IF EXISTS civicrm_financial_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_financial_type_before_update //
DROP TRIGGER IF EXISTS civicrm_financial_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_financial_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_financial_type_after_update //
DROP TRIGGER IF EXISTS civicrm_financial_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_geocoder_before_insert //
DROP TRIGGER IF EXISTS civicrm_geocoder_before_update //
DROP TRIGGER IF EXISTS civicrm_geocoder_before_delete //
DROP TRIGGER IF EXISTS civicrm_geocoder_after_insert //
DROP TRIGGER IF EXISTS civicrm_geocoder_after_update //
DROP TRIGGER IF EXISTS civicrm_geocoder_after_delete //
DROP TRIGGER IF EXISTS civicrm_grant_before_insert //
DROP TRIGGER IF EXISTS civicrm_grant_before_update //
DROP TRIGGER IF EXISTS civicrm_grant_before_delete //
DROP TRIGGER IF EXISTS civicrm_grant_after_insert //
DROP TRIGGER IF EXISTS civicrm_grant_after_update //
DROP TRIGGER IF EXISTS civicrm_grant_after_delete //
DROP TRIGGER IF EXISTS civicrm_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_group_before_update //
DROP TRIGGER IF EXISTS civicrm_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_group_after_update //
DROP TRIGGER IF EXISTS civicrm_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_group_contact_before_insert //
DROP TRIGGER IF EXISTS civicrm_group_contact_before_update //
DROP TRIGGER IF EXISTS civicrm_group_contact_before_delete //
DROP TRIGGER IF EXISTS civicrm_group_contact_after_insert //
DROP TRIGGER IF EXISTS civicrm_group_contact_after_update //
DROP TRIGGER IF EXISTS civicrm_group_contact_after_delete //
DROP TRIGGER IF EXISTS civicrm_group_nesting_before_insert //
DROP TRIGGER IF EXISTS civicrm_group_nesting_before_update //
DROP TRIGGER IF EXISTS civicrm_group_nesting_before_delete //
DROP TRIGGER IF EXISTS civicrm_group_nesting_after_insert //
DROP TRIGGER IF EXISTS civicrm_group_nesting_after_update //
DROP TRIGGER IF EXISTS civicrm_group_nesting_after_delete //
DROP TRIGGER IF EXISTS civicrm_group_organization_before_insert //
DROP TRIGGER IF EXISTS civicrm_group_organization_before_update //
DROP TRIGGER IF EXISTS civicrm_group_organization_before_delete //
DROP TRIGGER IF EXISTS civicrm_group_organization_after_insert //
DROP TRIGGER IF EXISTS civicrm_group_organization_after_update //
DROP TRIGGER IF EXISTS civicrm_group_organization_after_delete //
DROP TRIGGER IF EXISTS civicrm_im_before_insert //
DROP TRIGGER IF EXISTS civicrm_im_before_update //
DROP TRIGGER IF EXISTS civicrm_im_before_delete //
DROP TRIGGER IF EXISTS civicrm_im_after_insert //
DROP TRIGGER IF EXISTS civicrm_im_after_update //
DROP TRIGGER IF EXISTS civicrm_im_after_delete //
DROP TRIGGER IF EXISTS civicrm_job_before_insert //
DROP TRIGGER IF EXISTS civicrm_job_before_update //
DROP TRIGGER IF EXISTS civicrm_job_before_delete //
DROP TRIGGER IF EXISTS civicrm_job_after_insert //
DROP TRIGGER IF EXISTS civicrm_job_after_update //
DROP TRIGGER IF EXISTS civicrm_job_after_delete //
DROP TRIGGER IF EXISTS civicrm_loc_block_before_insert //
DROP TRIGGER IF EXISTS civicrm_loc_block_before_update //
DROP TRIGGER IF EXISTS civicrm_loc_block_before_delete //
DROP TRIGGER IF EXISTS civicrm_loc_block_after_insert //
DROP TRIGGER IF EXISTS civicrm_loc_block_after_update //
DROP TRIGGER IF EXISTS civicrm_loc_block_after_delete //
DROP TRIGGER IF EXISTS civicrm_location_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_location_type_before_update //
DROP TRIGGER IF EXISTS civicrm_location_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_location_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_location_type_after_update //
DROP TRIGGER IF EXISTS civicrm_location_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_mail_settings_before_insert //
DROP TRIGGER IF EXISTS civicrm_mail_settings_before_update //
DROP TRIGGER IF EXISTS civicrm_mail_settings_before_delete //
DROP TRIGGER IF EXISTS civicrm_mail_settings_after_insert //
DROP TRIGGER IF EXISTS civicrm_mail_settings_after_update //
DROP TRIGGER IF EXISTS civicrm_mail_settings_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_abtest_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_pattern_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_bounce_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_component_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_component_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_component_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_component_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_component_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_component_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_group_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_group_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_spool_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_stats_performance_after_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_before_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_before_update //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_before_delete //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_after_insert //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_after_update //
DROP TRIGGER IF EXISTS civicrm_mailing_trackable_url_after_delete //
DROP TRIGGER IF EXISTS civicrm_managed_before_insert //
DROP TRIGGER IF EXISTS civicrm_managed_before_update //
DROP TRIGGER IF EXISTS civicrm_managed_before_delete //
DROP TRIGGER IF EXISTS civicrm_managed_after_insert //
DROP TRIGGER IF EXISTS civicrm_managed_after_update //
DROP TRIGGER IF EXISTS civicrm_managed_after_delete //
DROP TRIGGER IF EXISTS civicrm_mapping_before_insert //
DROP TRIGGER IF EXISTS civicrm_mapping_before_update //
DROP TRIGGER IF EXISTS civicrm_mapping_before_delete //
DROP TRIGGER IF EXISTS civicrm_mapping_after_insert //
DROP TRIGGER IF EXISTS civicrm_mapping_after_update //
DROP TRIGGER IF EXISTS civicrm_mapping_after_delete //
DROP TRIGGER IF EXISTS civicrm_mapping_field_before_insert //
DROP TRIGGER IF EXISTS civicrm_mapping_field_before_update //
DROP TRIGGER IF EXISTS civicrm_mapping_field_before_delete //
DROP TRIGGER IF EXISTS civicrm_mapping_field_after_insert //
DROP TRIGGER IF EXISTS civicrm_mapping_field_after_update //
DROP TRIGGER IF EXISTS civicrm_mapping_field_after_delete //
DROP TRIGGER IF EXISTS civicrm_membership_before_insert //
DROP TRIGGER IF EXISTS civicrm_membership_before_update //
DROP TRIGGER IF EXISTS civicrm_membership_before_delete //
DROP TRIGGER IF EXISTS civicrm_membership_after_insert //
DROP TRIGGER IF EXISTS civicrm_membership_after_update //
DROP TRIGGER IF EXISTS civicrm_membership_after_delete //
DROP TRIGGER IF EXISTS civicrm_membership_block_before_insert //
DROP TRIGGER IF EXISTS civicrm_membership_block_before_update //
DROP TRIGGER IF EXISTS civicrm_membership_block_before_delete //
DROP TRIGGER IF EXISTS civicrm_membership_block_after_insert //
DROP TRIGGER IF EXISTS civicrm_membership_block_after_update //
DROP TRIGGER IF EXISTS civicrm_membership_block_after_delete //
DROP TRIGGER IF EXISTS civicrm_membership_payment_before_insert //
DROP TRIGGER IF EXISTS civicrm_membership_payment_before_update //
DROP TRIGGER IF EXISTS civicrm_membership_payment_before_delete //
DROP TRIGGER IF EXISTS civicrm_membership_payment_after_insert //
DROP TRIGGER IF EXISTS civicrm_membership_payment_after_update //
DROP TRIGGER IF EXISTS civicrm_membership_payment_after_delete //
DROP TRIGGER IF EXISTS civicrm_membership_status_before_insert //
DROP TRIGGER IF EXISTS civicrm_membership_status_before_update //
DROP TRIGGER IF EXISTS civicrm_membership_status_before_delete //
DROP TRIGGER IF EXISTS civicrm_membership_status_after_insert //
DROP TRIGGER IF EXISTS civicrm_membership_status_after_update //
DROP TRIGGER IF EXISTS civicrm_membership_status_after_delete //
DROP TRIGGER IF EXISTS civicrm_membership_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_membership_type_before_update //
DROP TRIGGER IF EXISTS civicrm_membership_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_membership_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_membership_type_after_update //
DROP TRIGGER IF EXISTS civicrm_membership_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_before_insert //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_before_update //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_before_delete //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_after_insert //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_after_update //
DROP TRIGGER IF EXISTS civicrm_mergeconflict_after_delete //
DROP TRIGGER IF EXISTS civicrm_monolog_before_insert //
DROP TRIGGER IF EXISTS civicrm_monolog_before_update //
DROP TRIGGER IF EXISTS civicrm_monolog_before_delete //
DROP TRIGGER IF EXISTS civicrm_monolog_after_insert //
DROP TRIGGER IF EXISTS civicrm_monolog_after_update //
DROP TRIGGER IF EXISTS civicrm_monolog_after_delete //
DROP TRIGGER IF EXISTS civicrm_msg_template_before_insert //
DROP TRIGGER IF EXISTS civicrm_msg_template_before_update //
DROP TRIGGER IF EXISTS civicrm_msg_template_before_delete //
DROP TRIGGER IF EXISTS civicrm_msg_template_after_insert //
DROP TRIGGER IF EXISTS civicrm_msg_template_after_update //
DROP TRIGGER IF EXISTS civicrm_msg_template_after_delete //
DROP TRIGGER IF EXISTS civicrm_navigation_before_insert //
DROP TRIGGER IF EXISTS civicrm_navigation_before_update //
DROP TRIGGER IF EXISTS civicrm_navigation_before_delete //
DROP TRIGGER IF EXISTS civicrm_navigation_after_insert //
DROP TRIGGER IF EXISTS civicrm_navigation_after_update //
DROP TRIGGER IF EXISTS civicrm_navigation_after_delete //
DROP TRIGGER IF EXISTS civicrm_note_before_insert //
DROP TRIGGER IF EXISTS civicrm_note_before_update //
DROP TRIGGER IF EXISTS civicrm_note_before_delete //
DROP TRIGGER IF EXISTS civicrm_note_after_insert //
DROP TRIGGER IF EXISTS civicrm_note_after_update //
DROP TRIGGER IF EXISTS civicrm_note_after_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_client_before_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_client_before_update //
DROP TRIGGER IF EXISTS civicrm_oauth_client_before_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_client_after_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_client_after_update //
DROP TRIGGER IF EXISTS civicrm_oauth_client_after_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_before_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_before_update //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_before_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_after_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_after_update //
DROP TRIGGER IF EXISTS civicrm_oauth_contact_token_after_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_before_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_before_update //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_before_delete //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_after_insert //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_after_update //
DROP TRIGGER IF EXISTS civicrm_oauth_systoken_after_delete //
DROP TRIGGER IF EXISTS civicrm_openid_before_insert //
DROP TRIGGER IF EXISTS civicrm_openid_before_update //
DROP TRIGGER IF EXISTS civicrm_openid_before_delete //
DROP TRIGGER IF EXISTS civicrm_openid_after_insert //
DROP TRIGGER IF EXISTS civicrm_openid_after_update //
DROP TRIGGER IF EXISTS civicrm_openid_after_delete //
DROP TRIGGER IF EXISTS civicrm_option_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_option_group_before_update //
DROP TRIGGER IF EXISTS civicrm_option_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_option_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_option_group_after_update //
DROP TRIGGER IF EXISTS civicrm_option_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_option_value_before_insert //
DROP TRIGGER IF EXISTS civicrm_option_value_before_update //
DROP TRIGGER IF EXISTS civicrm_option_value_before_delete //
DROP TRIGGER IF EXISTS civicrm_option_value_after_insert //
DROP TRIGGER IF EXISTS civicrm_option_value_after_update //
DROP TRIGGER IF EXISTS civicrm_option_value_after_delete //
DROP TRIGGER IF EXISTS civicrm_participant_before_insert //
DROP TRIGGER IF EXISTS civicrm_participant_before_update //
DROP TRIGGER IF EXISTS civicrm_participant_before_delete //
DROP TRIGGER IF EXISTS civicrm_participant_after_insert //
DROP TRIGGER IF EXISTS civicrm_participant_after_update //
DROP TRIGGER IF EXISTS civicrm_participant_after_delete //
DROP TRIGGER IF EXISTS civicrm_participant_payment_before_insert //
DROP TRIGGER IF EXISTS civicrm_participant_payment_before_update //
DROP TRIGGER IF EXISTS civicrm_participant_payment_before_delete //
DROP TRIGGER IF EXISTS civicrm_participant_payment_after_insert //
DROP TRIGGER IF EXISTS civicrm_participant_payment_after_update //
DROP TRIGGER IF EXISTS civicrm_participant_payment_after_delete //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_before_update //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_after_update //
DROP TRIGGER IF EXISTS civicrm_participant_status_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_payment_processor_before_insert //
DROP TRIGGER IF EXISTS civicrm_payment_processor_before_update //
DROP TRIGGER IF EXISTS civicrm_payment_processor_before_delete //
DROP TRIGGER IF EXISTS civicrm_payment_processor_after_insert //
DROP TRIGGER IF EXISTS civicrm_payment_processor_after_update //
DROP TRIGGER IF EXISTS civicrm_payment_processor_after_delete //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_before_update //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_after_update //
DROP TRIGGER IF EXISTS civicrm_payment_processor_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_payment_token_before_insert //
DROP TRIGGER IF EXISTS civicrm_payment_token_before_update //
DROP TRIGGER IF EXISTS civicrm_payment_token_before_delete //
DROP TRIGGER IF EXISTS civicrm_payment_token_after_insert //
DROP TRIGGER IF EXISTS civicrm_payment_token_after_update //
DROP TRIGGER IF EXISTS civicrm_payment_token_after_delete //
DROP TRIGGER IF EXISTS civicrm_pcp_before_insert //
DROP TRIGGER IF EXISTS civicrm_pcp_before_update //
DROP TRIGGER IF EXISTS civicrm_pcp_before_delete //
DROP TRIGGER IF EXISTS civicrm_pcp_after_insert //
DROP TRIGGER IF EXISTS civicrm_pcp_after_update //
DROP TRIGGER IF EXISTS civicrm_pcp_after_delete //
DROP TRIGGER IF EXISTS civicrm_pcp_block_before_insert //
DROP TRIGGER IF EXISTS civicrm_pcp_block_before_update //
DROP TRIGGER IF EXISTS civicrm_pcp_block_before_delete //
DROP TRIGGER IF EXISTS civicrm_pcp_block_after_insert //
DROP TRIGGER IF EXISTS civicrm_pcp_block_after_update //
DROP TRIGGER IF EXISTS civicrm_pcp_block_after_delete //
DROP TRIGGER IF EXISTS civicrm_phone_before_insert //
DROP TRIGGER IF EXISTS civicrm_phone_before_update //
DROP TRIGGER IF EXISTS civicrm_phone_before_delete //
DROP TRIGGER IF EXISTS civicrm_phone_after_insert //
DROP TRIGGER IF EXISTS civicrm_phone_after_update //
DROP TRIGGER IF EXISTS civicrm_phone_after_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_before_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_before_update //
DROP TRIGGER IF EXISTS civicrm_pledge_before_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_after_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_after_update //
DROP TRIGGER IF EXISTS civicrm_pledge_after_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_block_before_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_block_before_update //
DROP TRIGGER IF EXISTS civicrm_pledge_block_before_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_block_after_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_block_after_update //
DROP TRIGGER IF EXISTS civicrm_pledge_block_after_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_before_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_before_update //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_before_delete //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_after_insert //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_after_update //
DROP TRIGGER IF EXISTS civicrm_pledge_payment_after_delete //
DROP TRIGGER IF EXISTS civicrm_preferences_date_before_insert //
DROP TRIGGER IF EXISTS civicrm_preferences_date_before_update //
DROP TRIGGER IF EXISTS civicrm_preferences_date_before_delete //
DROP TRIGGER IF EXISTS civicrm_preferences_date_after_insert //
DROP TRIGGER IF EXISTS civicrm_preferences_date_after_update //
DROP TRIGGER IF EXISTS civicrm_preferences_date_after_delete //
DROP TRIGGER IF EXISTS civicrm_premiums_before_insert //
DROP TRIGGER IF EXISTS civicrm_premiums_before_update //
DROP TRIGGER IF EXISTS civicrm_premiums_before_delete //
DROP TRIGGER IF EXISTS civicrm_premiums_after_insert //
DROP TRIGGER IF EXISTS civicrm_premiums_after_update //
DROP TRIGGER IF EXISTS civicrm_premiums_after_delete //
DROP TRIGGER IF EXISTS civicrm_premiums_product_before_insert //
DROP TRIGGER IF EXISTS civicrm_premiums_product_before_update //
DROP TRIGGER IF EXISTS civicrm_premiums_product_before_delete //
DROP TRIGGER IF EXISTS civicrm_premiums_product_after_insert //
DROP TRIGGER IF EXISTS civicrm_premiums_product_after_update //
DROP TRIGGER IF EXISTS civicrm_premiums_product_after_delete //
DROP TRIGGER IF EXISTS civicrm_price_field_before_insert //
DROP TRIGGER IF EXISTS civicrm_price_field_before_update //
DROP TRIGGER IF EXISTS civicrm_price_field_before_delete //
DROP TRIGGER IF EXISTS civicrm_price_field_after_insert //
DROP TRIGGER IF EXISTS civicrm_price_field_after_update //
DROP TRIGGER IF EXISTS civicrm_price_field_after_delete //
DROP TRIGGER IF EXISTS civicrm_price_field_value_before_insert //
DROP TRIGGER IF EXISTS civicrm_price_field_value_before_update //
DROP TRIGGER IF EXISTS civicrm_price_field_value_before_delete //
DROP TRIGGER IF EXISTS civicrm_price_field_value_after_insert //
DROP TRIGGER IF EXISTS civicrm_price_field_value_after_update //
DROP TRIGGER IF EXISTS civicrm_price_field_value_after_delete //
DROP TRIGGER IF EXISTS civicrm_price_set_before_insert //
DROP TRIGGER IF EXISTS civicrm_price_set_before_update //
DROP TRIGGER IF EXISTS civicrm_price_set_before_delete //
DROP TRIGGER IF EXISTS civicrm_price_set_after_insert //
DROP TRIGGER IF EXISTS civicrm_price_set_after_update //
DROP TRIGGER IF EXISTS civicrm_price_set_after_delete //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_before_insert //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_before_update //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_before_delete //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_after_insert //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_after_update //
DROP TRIGGER IF EXISTS civicrm_price_set_entity_after_delete //
DROP TRIGGER IF EXISTS civicrm_print_label_before_insert //
DROP TRIGGER IF EXISTS civicrm_print_label_before_update //
DROP TRIGGER IF EXISTS civicrm_print_label_before_delete //
DROP TRIGGER IF EXISTS civicrm_print_label_after_insert //
DROP TRIGGER IF EXISTS civicrm_print_label_after_update //
DROP TRIGGER IF EXISTS civicrm_print_label_after_delete //
DROP TRIGGER IF EXISTS civicrm_product_before_insert //
DROP TRIGGER IF EXISTS civicrm_product_before_update //
DROP TRIGGER IF EXISTS civicrm_product_before_delete //
DROP TRIGGER IF EXISTS civicrm_product_after_insert //
DROP TRIGGER IF EXISTS civicrm_product_after_update //
DROP TRIGGER IF EXISTS civicrm_product_after_delete //
DROP TRIGGER IF EXISTS civicrm_queue_before_insert //
DROP TRIGGER IF EXISTS civicrm_queue_before_update //
DROP TRIGGER IF EXISTS civicrm_queue_before_delete //
DROP TRIGGER IF EXISTS civicrm_queue_after_insert //
DROP TRIGGER IF EXISTS civicrm_queue_after_update //
DROP TRIGGER IF EXISTS civicrm_queue_after_delete //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_before_insert //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_before_update //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_before_delete //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_after_insert //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_after_update //
DROP TRIGGER IF EXISTS civicrm_recurring_entity_after_delete //
DROP TRIGGER IF EXISTS civicrm_relationship_before_insert //
DROP TRIGGER IF EXISTS civicrm_relationship_before_update //
DROP TRIGGER IF EXISTS civicrm_relationship_before_delete //
DROP TRIGGER IF EXISTS civicrm_relationship_after_insert //
DROP TRIGGER IF EXISTS civicrm_relationship_after_update //
DROP TRIGGER IF EXISTS civicrm_relationship_after_delete //
DROP TRIGGER IF EXISTS civicrm_relationship_type_before_insert //
DROP TRIGGER IF EXISTS civicrm_relationship_type_before_update //
DROP TRIGGER IF EXISTS civicrm_relationship_type_before_delete //
DROP TRIGGER IF EXISTS civicrm_relationship_type_after_insert //
DROP TRIGGER IF EXISTS civicrm_relationship_type_after_update //
DROP TRIGGER IF EXISTS civicrm_relationship_type_after_delete //
DROP TRIGGER IF EXISTS civicrm_report_instance_before_insert //
DROP TRIGGER IF EXISTS civicrm_report_instance_before_update //
DROP TRIGGER IF EXISTS civicrm_report_instance_before_delete //
DROP TRIGGER IF EXISTS civicrm_report_instance_after_insert //
DROP TRIGGER IF EXISTS civicrm_report_instance_after_update //
DROP TRIGGER IF EXISTS civicrm_report_instance_after_delete //
DROP TRIGGER IF EXISTS civicrm_saved_search_before_insert //
DROP TRIGGER IF EXISTS civicrm_saved_search_before_update //
DROP TRIGGER IF EXISTS civicrm_saved_search_before_delete //
DROP TRIGGER IF EXISTS civicrm_saved_search_after_insert //
DROP TRIGGER IF EXISTS civicrm_saved_search_after_update //
DROP TRIGGER IF EXISTS civicrm_saved_search_after_delete //
DROP TRIGGER IF EXISTS civicrm_search_display_before_insert //
DROP TRIGGER IF EXISTS civicrm_search_display_before_update //
DROP TRIGGER IF EXISTS civicrm_search_display_before_delete //
DROP TRIGGER IF EXISTS civicrm_search_display_after_insert //
DROP TRIGGER IF EXISTS civicrm_search_display_after_update //
DROP TRIGGER IF EXISTS civicrm_search_display_after_delete //
DROP TRIGGER IF EXISTS civicrm_search_segment_before_insert //
DROP TRIGGER IF EXISTS civicrm_search_segment_before_update //
DROP TRIGGER IF EXISTS civicrm_search_segment_before_delete //
DROP TRIGGER IF EXISTS civicrm_search_segment_after_insert //
DROP TRIGGER IF EXISTS civicrm_search_segment_after_update //
DROP TRIGGER IF EXISTS civicrm_search_segment_after_delete //
DROP TRIGGER IF EXISTS civicrm_setting_before_insert //
DROP TRIGGER IF EXISTS civicrm_setting_before_update //
DROP TRIGGER IF EXISTS civicrm_setting_before_delete //
DROP TRIGGER IF EXISTS civicrm_setting_after_insert //
DROP TRIGGER IF EXISTS civicrm_setting_after_update //
DROP TRIGGER IF EXISTS civicrm_setting_after_delete //
DROP TRIGGER IF EXISTS civicrm_sms_provider_before_insert //
DROP TRIGGER IF EXISTS civicrm_sms_provider_before_update //
DROP TRIGGER IF EXISTS civicrm_sms_provider_before_delete //
DROP TRIGGER IF EXISTS civicrm_sms_provider_after_insert //
DROP TRIGGER IF EXISTS civicrm_sms_provider_after_update //
DROP TRIGGER IF EXISTS civicrm_sms_provider_after_delete //
DROP TRIGGER IF EXISTS civicrm_state_province_before_insert //
DROP TRIGGER IF EXISTS civicrm_state_province_before_update //
DROP TRIGGER IF EXISTS civicrm_state_province_before_delete //
DROP TRIGGER IF EXISTS civicrm_state_province_after_insert //
DROP TRIGGER IF EXISTS civicrm_state_province_after_update //
DROP TRIGGER IF EXISTS civicrm_state_province_after_delete //
DROP TRIGGER IF EXISTS civicrm_status_pref_before_insert //
DROP TRIGGER IF EXISTS civicrm_status_pref_before_update //
DROP TRIGGER IF EXISTS civicrm_status_pref_before_delete //
DROP TRIGGER IF EXISTS civicrm_status_pref_after_insert //
DROP TRIGGER IF EXISTS civicrm_status_pref_after_update //
DROP TRIGGER IF EXISTS civicrm_status_pref_after_delete //
DROP TRIGGER IF EXISTS civicrm_survey_before_insert //
DROP TRIGGER IF EXISTS civicrm_survey_before_update //
DROP TRIGGER IF EXISTS civicrm_survey_before_delete //
DROP TRIGGER IF EXISTS civicrm_survey_after_insert //
DROP TRIGGER IF EXISTS civicrm_survey_after_update //
DROP TRIGGER IF EXISTS civicrm_survey_after_delete //
DROP TRIGGER IF EXISTS civicrm_tag_before_insert //
DROP TRIGGER IF EXISTS civicrm_tag_before_update //
DROP TRIGGER IF EXISTS civicrm_tag_before_delete //
DROP TRIGGER IF EXISTS civicrm_tag_after_insert //
DROP TRIGGER IF EXISTS civicrm_tag_after_update //
DROP TRIGGER IF EXISTS civicrm_tag_after_delete //
DROP TRIGGER IF EXISTS civicrm_tell_friend_before_insert //
DROP TRIGGER IF EXISTS civicrm_tell_friend_before_update //
DROP TRIGGER IF EXISTS civicrm_tell_friend_before_delete //
DROP TRIGGER IF EXISTS civicrm_tell_friend_after_insert //
DROP TRIGGER IF EXISTS civicrm_tell_friend_after_update //
DROP TRIGGER IF EXISTS civicrm_tell_friend_after_delete //
DROP TRIGGER IF EXISTS civicrm_timezone_before_insert //
DROP TRIGGER IF EXISTS civicrm_timezone_before_update //
DROP TRIGGER IF EXISTS civicrm_timezone_before_delete //
DROP TRIGGER IF EXISTS civicrm_timezone_after_insert //
DROP TRIGGER IF EXISTS civicrm_timezone_after_update //
DROP TRIGGER IF EXISTS civicrm_timezone_after_delete //
DROP TRIGGER IF EXISTS civicrm_translation_before_insert //
DROP TRIGGER IF EXISTS civicrm_translation_before_update //
DROP TRIGGER IF EXISTS civicrm_translation_before_delete //
DROP TRIGGER IF EXISTS civicrm_translation_after_insert //
DROP TRIGGER IF EXISTS civicrm_translation_after_update //
DROP TRIGGER IF EXISTS civicrm_translation_after_delete //
DROP TRIGGER IF EXISTS civicrm_uf_field_before_insert //
DROP TRIGGER IF EXISTS civicrm_uf_field_before_update //
DROP TRIGGER IF EXISTS civicrm_uf_field_before_delete //
DROP TRIGGER IF EXISTS civicrm_uf_field_after_insert //
DROP TRIGGER IF EXISTS civicrm_uf_field_after_update //
DROP TRIGGER IF EXISTS civicrm_uf_field_after_delete //
DROP TRIGGER IF EXISTS civicrm_uf_group_before_insert //
DROP TRIGGER IF EXISTS civicrm_uf_group_before_update //
DROP TRIGGER IF EXISTS civicrm_uf_group_before_delete //
DROP TRIGGER IF EXISTS civicrm_uf_group_after_insert //
DROP TRIGGER IF EXISTS civicrm_uf_group_after_update //
DROP TRIGGER IF EXISTS civicrm_uf_group_after_delete //
DROP TRIGGER IF EXISTS civicrm_uf_join_before_insert //
DROP TRIGGER IF EXISTS civicrm_uf_join_before_update //
DROP TRIGGER IF EXISTS civicrm_uf_join_before_delete //
DROP TRIGGER IF EXISTS civicrm_uf_join_after_insert //
DROP TRIGGER IF EXISTS civicrm_uf_join_after_update //
DROP TRIGGER IF EXISTS civicrm_uf_join_after_delete //
DROP TRIGGER IF EXISTS civicrm_uf_match_before_insert //
DROP TRIGGER IF EXISTS civicrm_uf_match_before_update //
DROP TRIGGER IF EXISTS civicrm_uf_match_before_delete //
DROP TRIGGER IF EXISTS civicrm_uf_match_after_insert //
DROP TRIGGER IF EXISTS civicrm_uf_match_after_update //
DROP TRIGGER IF EXISTS civicrm_uf_match_after_delete //
DROP TRIGGER IF EXISTS civicrm_user_job_before_insert //
DROP TRIGGER IF EXISTS civicrm_user_job_before_update //
DROP TRIGGER IF EXISTS civicrm_user_job_before_delete //
DROP TRIGGER IF EXISTS civicrm_user_job_after_insert //
DROP TRIGGER IF EXISTS civicrm_user_job_after_update //
DROP TRIGGER IF EXISTS civicrm_user_job_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_check_number_9_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_communication_4_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_currency_3_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_gift_data_7_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_primary_contact_name_9_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_prospect_5_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_soft_credit_data_8_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_solicitation_6_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_before_update //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_after_update //
DROP TRIGGER IF EXISTS civicrm_value_1_stock_information_10_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__before_insert //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__before_update //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__before_delete //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__after_insert //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__after_update //
DROP TRIGGER IF EXISTS civicrm_value_anonymous__after_delete //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_before_update //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_after_update //
DROP TRIGGER IF EXISTS civicrm_value_assistant_15_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_before_update //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_after_update //
DROP TRIGGER IF EXISTS civicrm_value_endowment_yea_28_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_before_update //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_after_update //
DROP TRIGGER IF EXISTS civicrm_value_group_metadata_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_before_update //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_after_update //
DROP TRIGGER IF EXISTS civicrm_value_mailing_data_21_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_before_update //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_after_update //
DROP TRIGGER IF EXISTS civicrm_value_major_gifts_y_27_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_before_update //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_after_update //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_before_update //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_after_update //
DROP TRIGGER IF EXISTS civicrm_value_matching_gift_29_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_before_update //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_after_update //
DROP TRIGGER IF EXISTS civicrm_value_organization_contact_14_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_before_update //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_after_update //
DROP TRIGGER IF EXISTS civicrm_value_partner_19_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_before_update //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_after_update //
DROP TRIGGER IF EXISTS civicrm_value_pg_commitment_25_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_before_update //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_after_update //
DROP TRIGGER IF EXISTS civicrm_value_pg_inquiry_ac_26_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_before_update //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_after_update //
DROP TRIGGER IF EXISTS civicrm_value_relationship__20_after_delete //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_before_insert //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_before_update //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_before_delete //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_after_insert //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_after_update //
DROP TRIGGER IF EXISTS civicrm_value_relationship_metadata_after_delete //
DROP TRIGGER IF EXISTS civicrm_website_before_insert //
DROP TRIGGER IF EXISTS civicrm_website_before_update //
DROP TRIGGER IF EXISTS civicrm_website_before_delete //
DROP TRIGGER IF EXISTS civicrm_website_after_insert //
DROP TRIGGER IF EXISTS civicrm_website_after_update //
DROP TRIGGER IF EXISTS civicrm_website_after_delete //
DROP TRIGGER IF EXISTS civicrm_word_replacement_before_insert //
DROP TRIGGER IF EXISTS civicrm_word_replacement_before_update //
DROP TRIGGER IF EXISTS civicrm_word_replacement_before_delete //
DROP TRIGGER IF EXISTS civicrm_word_replacement_after_insert //
DROP TRIGGER IF EXISTS civicrm_word_replacement_after_update //
DROP TRIGGER IF EXISTS civicrm_word_replacement_after_delete //
DROP TRIGGER IF EXISTS civicrm_worldregion_before_insert //
DROP TRIGGER IF EXISTS civicrm_worldregion_before_update //
DROP TRIGGER IF EXISTS civicrm_worldregion_before_delete //
DROP TRIGGER IF EXISTS civicrm_worldregion_after_insert //
DROP TRIGGER IF EXISTS civicrm_worldregion_after_update //
DROP TRIGGER IF EXISTS civicrm_worldregion_after_delete //
DROP TRIGGER IF EXISTS wmf_contribution_extra_before_insert //
DROP TRIGGER IF EXISTS wmf_contribution_extra_before_update //
DROP TRIGGER IF EXISTS wmf_contribution_extra_before_delete //
DROP TRIGGER IF EXISTS wmf_contribution_extra_after_insert //
DROP TRIGGER IF EXISTS wmf_contribution_extra_after_update //
DROP TRIGGER IF EXISTS wmf_contribution_extra_after_delete //
DROP FUNCTION IF EXISTS civicrm_strip_non_numeric //

    CREATE FUNCTION civicrm_strip_non_numeric(input VARCHAR(255))
      RETURNS VARCHAR(255)
      DETERMINISTIC
      NO SQL
    BEGIN
      DECLARE output   VARCHAR(255) DEFAULT '';
      DECLARE iterator INT          DEFAULT 1;
      WHILE iterator < (LENGTH(input) + 1) DO
        IF SUBSTRING(input, iterator, 1) IN ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9') THEN
          SET output = CONCAT(output, SUBSTRING(input, iterator, 1));
        END IF;
        SET iterator = iterator + 1;
      END WHILE;
      RETURN output;
    END //

CREATE TRIGGER civicrm_activity_before_insert before insert ON civicrm_activity FOR EACH ROW BEGIN  
SET NEW.created_date = CURRENT_TIMESTAMP;
 END //

CREATE TRIGGER civicrm_activity_before_update before update ON civicrm_activity FOR EACH ROW BEGIN  UPDATE civicrm_case SET modified_date = CURRENT_TIMESTAMP WHERE id IN (SELECT ca.case_id FROM civicrm_case_activity ca WHERE ca.activity_id = OLD.id); END //

CREATE TRIGGER civicrm_activity_before_delete before delete ON civicrm_activity FOR EACH ROW BEGIN  UPDATE civicrm_case SET modified_date = CURRENT_TIMESTAMP WHERE id IN (SELECT ca.case_id FROM civicrm_case_activity ca WHERE ca.activity_id = OLD.id); END //

CREATE TRIGGER civicrm_address_after_insert after insert ON civicrm_address FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_address_after_update after update ON civicrm_address FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_address_after_delete after delete ON civicrm_address FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //

CREATE TRIGGER civicrm_case_before_insert before insert ON civicrm_case FOR EACH ROW BEGIN  
SET NEW.created_date = CURRENT_TIMESTAMP;
 END //

CREATE TRIGGER civicrm_case_activity_after_insert after insert ON civicrm_case_activity FOR EACH ROW BEGIN  UPDATE civicrm_case SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.case_id; END //

CREATE TRIGGER civicrm_contact_before_insert before insert ON civicrm_contact FOR EACH ROW BEGIN  
SET NEW.created_date = CURRENT_TIMESTAMP;
 END //

CREATE TRIGGER civicrm_contribution_after_insert after insert ON civicrm_contribution FOR EACH ROW BEGIN   IF 1 AND (NEW.contact_id NOT IN (2123835,19855599,12513,72)) THEN
      INSERT INTO wmf_donor (
        entity_id, donor_segment_id, donor_status_id, last_donation_currency, last_donation_amount, last_donation_usd, first_donation_usd, date_of_largest_donation, largest_donation, endowment_largest_donation, all_funds_largest_donation, lifetime_including_endowment, lifetime_usd_total, endowment_lifetime_usd_total, last_donation_date, endowment_last_donation_date, all_funds_last_donation_date, first_donation_date, endowment_first_donation_date, all_funds_first_donation_date, number_donations, endowment_number_donations, all_funds_number_donations, total_2006_2007, total_2006, total_2007_2008, total_2007, total_2008_2009, total_2008, total_2009_2010, total_2009, total_2010_2011, total_2010, total_2011_2012, total_2011, total_2012_2013, total_2012, total_2013_2014, total_2013, total_2014_2015, total_2014, total_2015_2016, total_2015, total_2016_2017, total_2016, total_2017_2018, total_2017, change_2017_2018, total_2018_2019, total_2018, endowment_total_2018_2019, endowment_total_2018, all_funds_total_2018_2019, all_funds_change_2018_2019, change_2018_2019, total_2019_2020, total_2019, endowment_total_2019_2020, endowment_total_2019, all_funds_total_2019_2020, all_funds_change_2019_2020, change_2019_2020, total_2020_2021, total_2020, endowment_total_2020_2021, endowment_total_2020, all_funds_total_2020_2021, all_funds_change_2020_2021, endowment_change_2020_2021, change_2020_2021, total_2021_2022, total_2021, endowment_total_2021_2022, endowment_total_2021, all_funds_total_2021_2022, all_funds_change_2021_2022, endowment_change_2021_2022, change_2021_2022, total_2022_2023, total_2022, endowment_total_2022_2023, endowment_total_2022, all_funds_total_2022_2023, all_funds_change_2022_2023, endowment_change_2022_2023, change_2022_2023, total_2023_2024, total_2023, endowment_total_2023_2024, endowment_total_2023, all_funds_total_2023_2024, all_funds_change_2023_2024, endowment_change_2023_2024, change_2023_2024, total_2024_2025, total_2024, endowment_total_2024_2025, endowment_total_2024, all_funds_total_2024_2025, all_funds_change_2024_2025, endowment_change_2024_2025, change_2024_2025, total_2025_2026, total_2025, endowment_total_2025_2026, endowment_total_2025, all_funds_total_2025_2026, all_funds_change_2025_2026, endowment_change_2025_2026, change_2025_2026
      )SELECT
       NEW.contact_id as entity_id , # to honour FULL_GROUP_BY mysql mode we need an aggregate command for each
 # field - even though we know we just want `the value from the subquery`
 # MAX is a safe wrapper for that
 # https://www.percona.com/blog/2019/05/13/solve-query-failures-regarding-only_full_group_by-sql-mode/
 MAX(donor_segment_id) as donor_segment_id, MAX(donor_status_id) as donor_status_id, MAX(COALESCE(x.original_currency,
 latest.currency)) as last_donation_currency, MAX(COALESCE(x.original_amount,
 latest.total_amount,
 0)) as last_donation_amount, MAX(COALESCE(latest.total_amount,
 0)) as last_donation_usd, MAX(COALESCE(earliest.total_amount,
 0)) as first_donation_usd, MAX(largest.receive_date) as date_of_largest_donation, MAX(largest_donation) as largest_donation, MAX(endowment_largest_donation) as endowment_largest_donation, MAX(all_funds_largest_donation) as all_funds_largest_donation, MAX(lifetime_including_endowment) as lifetime_including_endowment, MAX(lifetime_usd_total) as lifetime_usd_total, MAX(endowment_lifetime_usd_total) as endowment_lifetime_usd_total, MAX(last_donation_date) as last_donation_date, MAX(endowment_last_donation_date) as endowment_last_donation_date, MAX(all_funds_last_donation_date) as all_funds_last_donation_date, MIN(first_donation_date) as first_donation_date, MIN(endowment_first_donation_date) as endowment_first_donation_date, MIN(all_funds_first_donation_date) as all_funds_first_donation_date, MAX(number_donations) as number_donations, MAX(endowment_number_donations) as endowment_number_donations, MAX(all_funds_number_donations) as all_funds_number_donations, MAX(total_2006_2007) as total_2006_2007, MAX(total_2006) as total_2006, MAX(total_2007_2008) as total_2007_2008, MAX(total_2007) as total_2007, MAX(total_2008_2009) as total_2008_2009, MAX(total_2008) as total_2008, MAX(total_2009_2010) as total_2009_2010, MAX(total_2009) as total_2009, MAX(total_2010_2011) as total_2010_2011, MAX(total_2010) as total_2010, MAX(total_2011_2012) as total_2011_2012, MAX(total_2011) as total_2011, MAX(total_2012_2013) as total_2012_2013, MAX(total_2012) as total_2012, MAX(total_2013_2014) as total_2013_2014, MAX(total_2013) as total_2013, MAX(total_2014_2015) as total_2014_2015, MAX(total_2014) as total_2014, MAX(total_2015_2016) as total_2015_2016, MAX(total_2015) as total_2015, MAX(total_2016_2017) as total_2016_2017, MAX(total_2016) as total_2016, MAX(total_2017_2018) as total_2017_2018, MAX(total_2017) as total_2017, MAX(change_2017_2018) as change_2017_2018, MAX(total_2018_2019) as total_2018_2019, MAX(total_2018) as total_2018, MAX(endowment_total_2018_2019) as endowment_total_2018_2019, MAX(endowment_total_2018) as endowment_total_2018, MAX(all_funds_total_2018_2019) as all_funds_total_2018_2019, MAX(all_funds_change_2018_2019) as all_funds_change_2018_2019, MAX(change_2018_2019) as change_2018_2019, MAX(total_2019_2020) as total_2019_2020, MAX(total_2019) as total_2019, MAX(endowment_total_2019_2020) as endowment_total_2019_2020, MAX(endowment_total_2019) as endowment_total_2019, MAX(all_funds_total_2019_2020) as all_funds_total_2019_2020, MAX(all_funds_change_2019_2020) as all_funds_change_2019_2020, MAX(change_2019_2020) as change_2019_2020, MAX(total_2020_2021) as total_2020_2021, MAX(total_2020) as total_2020, MAX(endowment_total_2020_2021) as endowment_total_2020_2021, MAX(endowment_total_2020) as endowment_total_2020, MAX(all_funds_total_2020_2021) as all_funds_total_2020_2021, MAX(all_funds_change_2020_2021) as all_funds_change_2020_2021, MAX(endowment_change_2020_2021) as endowment_change_2020_2021, MAX(change_2020_2021) as change_2020_2021, MAX(total_2021_2022) as total_2021_2022, MAX(total_2021) as total_2021, MAX(endowment_total_2021_2022) as endowment_total_2021_2022, MAX(endowment_total_2021) as endowment_total_2021, MAX(all_funds_total_2021_2022) as all_funds_total_2021_2022, MAX(all_funds_change_2021_2022) as all_funds_change_2021_2022, MAX(endowment_change_2021_2022) as endowment_change_2021_2022, MAX(change_2021_2022) as change_2021_2022, MAX(total_2022_2023) as total_2022_2023, MAX(total_2022) as total_2022, MAX(endowment_total_2022_2023) as endowment_total_2022_2023, MAX(endowment_total_2022) as endowment_total_2022, MAX(all_funds_total_2022_2023) as all_funds_total_2022_2023, MAX(all_funds_change_2022_2023) as all_funds_change_2022_2023, MAX(endowment_change_2022_2023) as endowment_change_2022_2023, MAX(change_2022_2023) as change_2022_2023, MAX(total_2023_2024) as total_2023_2024, MAX(total_2023) as total_2023, MAX(endowment_total_2023_2024) as endowment_total_2023_2024, MAX(endowment_total_2023) as endowment_total_2023, MAX(all_funds_total_2023_2024) as all_funds_total_2023_2024, MAX(all_funds_change_2023_2024) as all_funds_change_2023_2024, MAX(endowment_change_2023_2024) as endowment_change_2023_2024, MAX(change_2023_2024) as change_2023_2024, MAX(total_2024_2025) as total_2024_2025, MAX(total_2024) as total_2024, MAX(endowment_total_2024_2025) as endowment_total_2024_2025, MAX(endowment_total_2024) as endowment_total_2024, MAX(all_funds_total_2024_2025) as all_funds_total_2024_2025, MAX(all_funds_change_2024_2025) as all_funds_change_2024_2025, MAX(endowment_change_2024_2025) as endowment_change_2024_2025, MAX(change_2024_2025) as change_2024_2025, MAX(total_2025_2026) as total_2025_2026, MAX(total_2025) as total_2025, MAX(endowment_total_2025_2026) as endowment_total_2025_2026, MAX(endowment_total_2025) as endowment_total_2025, MAX(all_funds_total_2025_2026) as all_funds_total_2025_2026, MAX(all_funds_change_2025_2026) as all_funds_change_2025_2026, MAX(endowment_change_2025_2026) as endowment_change_2025_2026, MAX(change_2025_2026) as change_2025_2026

    FROM (
      SELECT
  CASE 

         WHEN (
         --  Major Donor  has given 10,000+ in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000

        ) THEN 100


         WHEN (
         --  Mid Tier  has given 1,000+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000

        ) THEN 200


         WHEN (
         --  Recurring donor  has made a recurring donation in last 36 months
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 400


         WHEN (
         --  Grassroots Plus Donor  has given 50+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50

        ) THEN 500


         WHEN (
         --  Grassroots Donor  has given in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 600


         WHEN (
         --  All other Donors  has given but not in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 300 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 300 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 900

       ELSE 1000
       END  as donor_segment_id, 
CASE

         WHEN (
         --  Active Recurring  gave recurring within last month
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 80


         WHEN (
         --  Delinquent Recurring  gave recurring more than 1 month & less than 4 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 3 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 3 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 85


         WHEN (
         --  Deep lapsed Recurring  gave recurring more than 6 months & less than 37 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 6 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 6 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 95


         WHEN (
         --  New  first donation this FY
         MIN(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 10


         WHEN (
         --  Consecutive  gave last financial year and this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 20


         WHEN (
         --  Active  gave in this FY
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 30


         WHEN (
         --  Lybunt  gave last financial year but NOT this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 35


         WHEN (
         --  Lapsed  last gave in the financial year before last
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 50


         WHEN (
         --  Deep Lapsed  last gave between 3 & 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2020-07-01 00:00:00')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 60


         WHEN (
         --  Ultra lapsed  gave prior to 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('1999-06-30 23:59:59') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 70

       ELSE 100
       END  as donor_status_id, MAX(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS largest_donation, MAX(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_largest_donation, MAX(COALESCE(total_amount, 0)) AS all_funds_largest_donation, SUM(COALESCE(total_amount, 0)) AS lifetime_including_endowment, SUM(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS lifetime_usd_total, SUM(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_lifetime_usd_total, MAX(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS last_donation_date, MAX(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_last_donation_date, MAX(IF(total_amount > 0, receive_date, NULL)) AS all_funds_last_donation_date, MIN(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS first_donation_date, MIN(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_first_donation_date, MIN(IF(total_amount > 0, receive_date, NULL)) AS all_funds_first_donation_date, COUNT(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS number_donations, COUNT(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_number_donations, COUNT(IF(total_amount > 0, receive_date, NULL)) AS all_funds_number_donations, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-07-01' AND '2007-06-30 23:59:59', c.total_amount, 0),0)) as total_2006_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-01-01' AND '2006-12-31 23:59:59', c.total_amount, 0),0)) as total_2006, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-07-01' AND '2008-06-30 23:59:59', c.total_amount, 0),0)) as total_2007_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-01-01' AND '2007-12-31 23:59:59', c.total_amount, 0),0)) as total_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-07-01' AND '2009-06-30 23:59:59', c.total_amount, 0),0)) as total_2008_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-01-01' AND '2008-12-31 23:59:59', c.total_amount, 0),0)) as total_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-07-01' AND '2010-06-30 23:59:59', c.total_amount, 0),0)) as total_2009_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-01-01' AND '2009-12-31 23:59:59', c.total_amount, 0),0)) as total_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-07-01' AND '2011-06-30 23:59:59', c.total_amount, 0),0)) as total_2010_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-01-01' AND '2010-12-31 23:59:59', c.total_amount, 0),0)) as total_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-07-01' AND '2012-06-30 23:59:59', c.total_amount, 0),0)) as total_2011_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-01-01' AND '2011-12-31 23:59:59', c.total_amount, 0),0)) as total_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-07-01' AND '2013-06-30 23:59:59', c.total_amount, 0),0)) as total_2012_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-01-01' AND '2012-12-31 23:59:59', c.total_amount, 0),0)) as total_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-07-01' AND '2014-06-30 23:59:59', c.total_amount, 0),0)) as total_2013_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-01-01' AND '2013-12-31 23:59:59', c.total_amount, 0),0)) as total_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-07-01' AND '2015-06-30 23:59:59', c.total_amount, 0),0)) as total_2014_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-01-01' AND '2014-12-31 23:59:59', c.total_amount, 0),0)) as total_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-07-01' AND '2016-06-30 23:59:59', c.total_amount, 0),0)) as total_2015_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-01-01' AND '2015-12-31 23:59:59', c.total_amount, 0),0)) as total_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-07-01' AND '2017-06-30 23:59:59', c.total_amount, 0),0)) as total_2016_2017, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-01-01' AND '2016-12-31 23:59:59', c.total_amount, 0),0)) as total_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-07-01' AND '2018-06-30 23:59:59', c.total_amount, 0),0)) as total_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0)) as total_2017, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0))
            as change_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as total_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2018_2019, SUM(COALESCE(IF(receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2018_2019, 
              SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2018_2019, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            as change_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as total_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2019_2020, SUM(COALESCE(IF(receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2019_2020, 
              SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2019_2020, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            as change_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as total_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2020_2021, SUM(COALESCE(IF(receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2020_2021, 
              SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2020_2021, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2020_2021, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            as change_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as total_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2021_2022, SUM(COALESCE(IF(receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2021_2022, 
              SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2021_2022, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2021_2022, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            as change_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as total_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2022_2023, SUM(COALESCE(IF(receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2022_2023, 
              SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2022_2023, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2022_2023, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            as change_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as total_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2023_2024, SUM(COALESCE(IF(receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2023_2024, 
              SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2023_2024, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2023_2024, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            as change_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as total_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2024_2025, SUM(COALESCE(IF(receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2024_2025, 
              SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2024_2025, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2024_2025, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            as change_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as total_2025_2026, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2025_2026, SUM(COALESCE(IF(receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2025_2026, 
              SUM(COALESCE(IF(receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2025_2026, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2025_2026, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            as change_2025_2026
      FROM civicrm_contribution c
      USE INDEX(FK_civicrm_contribution_contact_id)
      WHERE  contact_id = NEW.contact_id 
        AND contribution_status_id = 1
        AND (c.trxn_id NOT LIKE 'RFD %' OR c.trxn_id IS NULL)
    ) as totals

  LEFT JOIN civicrm_contribution latest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON latest.contact_id =  NEW.contact_id
    AND latest.receive_date = totals.last_donation_date
    AND latest.contribution_status_id = 1
    AND latest.total_amount > 0
    AND (latest.trxn_id NOT LIKE 'RFD %' OR latest.trxn_id IS NULL)
    AND latest.financial_type_id <> 26
  LEFT JOIN wmf_contribution_extra x ON x.entity_id = latest.id

  LEFT JOIN civicrm_contribution earliest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON earliest.contact_id =  NEW.contact_id
    AND earliest.receive_date = totals.first_donation_date
    AND earliest.contribution_status_id = 1
    AND earliest.total_amount > 0
    AND (earliest.trxn_id NOT LIKE 'RFD %' OR earliest.trxn_id IS NULL)

  LEFT JOIN civicrm_contribution largest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON largest.contact_id =  NEW.contact_id 
    AND largest.total_amount = totals.largest_donation
    AND largest.contribution_status_id = 1
    AND largest.total_amount > 0
    AND (largest.trxn_id NOT LIKE 'RFD %' OR largest.trxn_id IS NULL) GROUP BY  NEW.contact_id
     ON DUPLICATE KEY UPDATE
    donor_segment_id = VALUES(donor_segment_id), donor_status_id = VALUES(donor_status_id), last_donation_currency = VALUES(last_donation_currency), last_donation_amount = VALUES(last_donation_amount), last_donation_usd = VALUES(last_donation_usd), first_donation_usd = VALUES(first_donation_usd), date_of_largest_donation = VALUES(date_of_largest_donation), largest_donation = VALUES(largest_donation), endowment_largest_donation = VALUES(endowment_largest_donation), all_funds_largest_donation = VALUES(all_funds_largest_donation), lifetime_including_endowment = VALUES(lifetime_including_endowment), lifetime_usd_total = VALUES(lifetime_usd_total), endowment_lifetime_usd_total = VALUES(endowment_lifetime_usd_total), last_donation_date = VALUES(last_donation_date), endowment_last_donation_date = VALUES(endowment_last_donation_date), all_funds_last_donation_date = VALUES(all_funds_last_donation_date), first_donation_date = VALUES(first_donation_date), endowment_first_donation_date = VALUES(endowment_first_donation_date), all_funds_first_donation_date = VALUES(all_funds_first_donation_date), number_donations = VALUES(number_donations), endowment_number_donations = VALUES(endowment_number_donations), all_funds_number_donations = VALUES(all_funds_number_donations), total_2006_2007 = VALUES(total_2006_2007), total_2006 = VALUES(total_2006), total_2007_2008 = VALUES(total_2007_2008), total_2007 = VALUES(total_2007), total_2008_2009 = VALUES(total_2008_2009), total_2008 = VALUES(total_2008), total_2009_2010 = VALUES(total_2009_2010), total_2009 = VALUES(total_2009), total_2010_2011 = VALUES(total_2010_2011), total_2010 = VALUES(total_2010), total_2011_2012 = VALUES(total_2011_2012), total_2011 = VALUES(total_2011), total_2012_2013 = VALUES(total_2012_2013), total_2012 = VALUES(total_2012), total_2013_2014 = VALUES(total_2013_2014), total_2013 = VALUES(total_2013), total_2014_2015 = VALUES(total_2014_2015), total_2014 = VALUES(total_2014), total_2015_2016 = VALUES(total_2015_2016), total_2015 = VALUES(total_2015), total_2016_2017 = VALUES(total_2016_2017), total_2016 = VALUES(total_2016), total_2017_2018 = VALUES(total_2017_2018), total_2017 = VALUES(total_2017), change_2017_2018 = VALUES(change_2017_2018), total_2018_2019 = VALUES(total_2018_2019), total_2018 = VALUES(total_2018), endowment_total_2018_2019 = VALUES(endowment_total_2018_2019), endowment_total_2018 = VALUES(endowment_total_2018), all_funds_total_2018_2019 = VALUES(all_funds_total_2018_2019), all_funds_change_2018_2019 = VALUES(all_funds_change_2018_2019), change_2018_2019 = VALUES(change_2018_2019), total_2019_2020 = VALUES(total_2019_2020), total_2019 = VALUES(total_2019), endowment_total_2019_2020 = VALUES(endowment_total_2019_2020), endowment_total_2019 = VALUES(endowment_total_2019), all_funds_total_2019_2020 = VALUES(all_funds_total_2019_2020), all_funds_change_2019_2020 = VALUES(all_funds_change_2019_2020), change_2019_2020 = VALUES(change_2019_2020), total_2020_2021 = VALUES(total_2020_2021), total_2020 = VALUES(total_2020), endowment_total_2020_2021 = VALUES(endowment_total_2020_2021), endowment_total_2020 = VALUES(endowment_total_2020), all_funds_total_2020_2021 = VALUES(all_funds_total_2020_2021), all_funds_change_2020_2021 = VALUES(all_funds_change_2020_2021), endowment_change_2020_2021 = VALUES(endowment_change_2020_2021), change_2020_2021 = VALUES(change_2020_2021), total_2021_2022 = VALUES(total_2021_2022), total_2021 = VALUES(total_2021), endowment_total_2021_2022 = VALUES(endowment_total_2021_2022), endowment_total_2021 = VALUES(endowment_total_2021), all_funds_total_2021_2022 = VALUES(all_funds_total_2021_2022), all_funds_change_2021_2022 = VALUES(all_funds_change_2021_2022), endowment_change_2021_2022 = VALUES(endowment_change_2021_2022), change_2021_2022 = VALUES(change_2021_2022), total_2022_2023 = VALUES(total_2022_2023), total_2022 = VALUES(total_2022), endowment_total_2022_2023 = VALUES(endowment_total_2022_2023), endowment_total_2022 = VALUES(endowment_total_2022), all_funds_total_2022_2023 = VALUES(all_funds_total_2022_2023), all_funds_change_2022_2023 = VALUES(all_funds_change_2022_2023), endowment_change_2022_2023 = VALUES(endowment_change_2022_2023), change_2022_2023 = VALUES(change_2022_2023), total_2023_2024 = VALUES(total_2023_2024), total_2023 = VALUES(total_2023), endowment_total_2023_2024 = VALUES(endowment_total_2023_2024), endowment_total_2023 = VALUES(endowment_total_2023), all_funds_total_2023_2024 = VALUES(all_funds_total_2023_2024), all_funds_change_2023_2024 = VALUES(all_funds_change_2023_2024), endowment_change_2023_2024 = VALUES(endowment_change_2023_2024), change_2023_2024 = VALUES(change_2023_2024), total_2024_2025 = VALUES(total_2024_2025), total_2024 = VALUES(total_2024), endowment_total_2024_2025 = VALUES(endowment_total_2024_2025), endowment_total_2024 = VALUES(endowment_total_2024), all_funds_total_2024_2025 = VALUES(all_funds_total_2024_2025), all_funds_change_2024_2025 = VALUES(all_funds_change_2024_2025), endowment_change_2024_2025 = VALUES(endowment_change_2024_2025), change_2024_2025 = VALUES(change_2024_2025), total_2025_2026 = VALUES(total_2025_2026), total_2025 = VALUES(total_2025), endowment_total_2025_2026 = VALUES(endowment_total_2025_2026), endowment_total_2025 = VALUES(endowment_total_2025), all_funds_total_2025_2026 = VALUES(all_funds_total_2025_2026), all_funds_change_2025_2026 = VALUES(all_funds_change_2025_2026), endowment_change_2025_2026 = VALUES(endowment_change_2025_2026), change_2025_2026 = VALUES(change_2025_2026); END IF;  END //

CREATE TRIGGER civicrm_contribution_after_update after update ON civicrm_contribution FOR EACH ROW BEGIN   IF 1 AND (NEW.contact_id NOT IN (2123835,19855599,12513,72)) AND ((NEW.contribution_status_id != OLD.contribution_status_id) OR (NEW.total_amount != OLD.total_amount) OR (NEW.contact_id != OLD.contact_id) OR (NEW.receive_date != OLD.receive_date) OR (NEW.currency != OLD.currency) OR (NEW.financial_type_id != OLD.financial_type_id) ) THEN
      INSERT INTO wmf_donor (
        entity_id, donor_segment_id, donor_status_id, last_donation_currency, last_donation_amount, last_donation_usd, first_donation_usd, date_of_largest_donation, largest_donation, endowment_largest_donation, all_funds_largest_donation, lifetime_including_endowment, lifetime_usd_total, endowment_lifetime_usd_total, last_donation_date, endowment_last_donation_date, all_funds_last_donation_date, first_donation_date, endowment_first_donation_date, all_funds_first_donation_date, number_donations, endowment_number_donations, all_funds_number_donations, total_2006_2007, total_2006, total_2007_2008, total_2007, total_2008_2009, total_2008, total_2009_2010, total_2009, total_2010_2011, total_2010, total_2011_2012, total_2011, total_2012_2013, total_2012, total_2013_2014, total_2013, total_2014_2015, total_2014, total_2015_2016, total_2015, total_2016_2017, total_2016, total_2017_2018, total_2017, change_2017_2018, total_2018_2019, total_2018, endowment_total_2018_2019, endowment_total_2018, all_funds_total_2018_2019, all_funds_change_2018_2019, change_2018_2019, total_2019_2020, total_2019, endowment_total_2019_2020, endowment_total_2019, all_funds_total_2019_2020, all_funds_change_2019_2020, change_2019_2020, total_2020_2021, total_2020, endowment_total_2020_2021, endowment_total_2020, all_funds_total_2020_2021, all_funds_change_2020_2021, endowment_change_2020_2021, change_2020_2021, total_2021_2022, total_2021, endowment_total_2021_2022, endowment_total_2021, all_funds_total_2021_2022, all_funds_change_2021_2022, endowment_change_2021_2022, change_2021_2022, total_2022_2023, total_2022, endowment_total_2022_2023, endowment_total_2022, all_funds_total_2022_2023, all_funds_change_2022_2023, endowment_change_2022_2023, change_2022_2023, total_2023_2024, total_2023, endowment_total_2023_2024, endowment_total_2023, all_funds_total_2023_2024, all_funds_change_2023_2024, endowment_change_2023_2024, change_2023_2024, total_2024_2025, total_2024, endowment_total_2024_2025, endowment_total_2024, all_funds_total_2024_2025, all_funds_change_2024_2025, endowment_change_2024_2025, change_2024_2025, total_2025_2026, total_2025, endowment_total_2025_2026, endowment_total_2025, all_funds_total_2025_2026, all_funds_change_2025_2026, endowment_change_2025_2026, change_2025_2026
      )SELECT
       NEW.contact_id as entity_id , # to honour FULL_GROUP_BY mysql mode we need an aggregate command for each
 # field - even though we know we just want `the value from the subquery`
 # MAX is a safe wrapper for that
 # https://www.percona.com/blog/2019/05/13/solve-query-failures-regarding-only_full_group_by-sql-mode/
 MAX(donor_segment_id) as donor_segment_id, MAX(donor_status_id) as donor_status_id, MAX(COALESCE(x.original_currency,
 latest.currency)) as last_donation_currency, MAX(COALESCE(x.original_amount,
 latest.total_amount,
 0)) as last_donation_amount, MAX(COALESCE(latest.total_amount,
 0)) as last_donation_usd, MAX(COALESCE(earliest.total_amount,
 0)) as first_donation_usd, MAX(largest.receive_date) as date_of_largest_donation, MAX(largest_donation) as largest_donation, MAX(endowment_largest_donation) as endowment_largest_donation, MAX(all_funds_largest_donation) as all_funds_largest_donation, MAX(lifetime_including_endowment) as lifetime_including_endowment, MAX(lifetime_usd_total) as lifetime_usd_total, MAX(endowment_lifetime_usd_total) as endowment_lifetime_usd_total, MAX(last_donation_date) as last_donation_date, MAX(endowment_last_donation_date) as endowment_last_donation_date, MAX(all_funds_last_donation_date) as all_funds_last_donation_date, MIN(first_donation_date) as first_donation_date, MIN(endowment_first_donation_date) as endowment_first_donation_date, MIN(all_funds_first_donation_date) as all_funds_first_donation_date, MAX(number_donations) as number_donations, MAX(endowment_number_donations) as endowment_number_donations, MAX(all_funds_number_donations) as all_funds_number_donations, MAX(total_2006_2007) as total_2006_2007, MAX(total_2006) as total_2006, MAX(total_2007_2008) as total_2007_2008, MAX(total_2007) as total_2007, MAX(total_2008_2009) as total_2008_2009, MAX(total_2008) as total_2008, MAX(total_2009_2010) as total_2009_2010, MAX(total_2009) as total_2009, MAX(total_2010_2011) as total_2010_2011, MAX(total_2010) as total_2010, MAX(total_2011_2012) as total_2011_2012, MAX(total_2011) as total_2011, MAX(total_2012_2013) as total_2012_2013, MAX(total_2012) as total_2012, MAX(total_2013_2014) as total_2013_2014, MAX(total_2013) as total_2013, MAX(total_2014_2015) as total_2014_2015, MAX(total_2014) as total_2014, MAX(total_2015_2016) as total_2015_2016, MAX(total_2015) as total_2015, MAX(total_2016_2017) as total_2016_2017, MAX(total_2016) as total_2016, MAX(total_2017_2018) as total_2017_2018, MAX(total_2017) as total_2017, MAX(change_2017_2018) as change_2017_2018, MAX(total_2018_2019) as total_2018_2019, MAX(total_2018) as total_2018, MAX(endowment_total_2018_2019) as endowment_total_2018_2019, MAX(endowment_total_2018) as endowment_total_2018, MAX(all_funds_total_2018_2019) as all_funds_total_2018_2019, MAX(all_funds_change_2018_2019) as all_funds_change_2018_2019, MAX(change_2018_2019) as change_2018_2019, MAX(total_2019_2020) as total_2019_2020, MAX(total_2019) as total_2019, MAX(endowment_total_2019_2020) as endowment_total_2019_2020, MAX(endowment_total_2019) as endowment_total_2019, MAX(all_funds_total_2019_2020) as all_funds_total_2019_2020, MAX(all_funds_change_2019_2020) as all_funds_change_2019_2020, MAX(change_2019_2020) as change_2019_2020, MAX(total_2020_2021) as total_2020_2021, MAX(total_2020) as total_2020, MAX(endowment_total_2020_2021) as endowment_total_2020_2021, MAX(endowment_total_2020) as endowment_total_2020, MAX(all_funds_total_2020_2021) as all_funds_total_2020_2021, MAX(all_funds_change_2020_2021) as all_funds_change_2020_2021, MAX(endowment_change_2020_2021) as endowment_change_2020_2021, MAX(change_2020_2021) as change_2020_2021, MAX(total_2021_2022) as total_2021_2022, MAX(total_2021) as total_2021, MAX(endowment_total_2021_2022) as endowment_total_2021_2022, MAX(endowment_total_2021) as endowment_total_2021, MAX(all_funds_total_2021_2022) as all_funds_total_2021_2022, MAX(all_funds_change_2021_2022) as all_funds_change_2021_2022, MAX(endowment_change_2021_2022) as endowment_change_2021_2022, MAX(change_2021_2022) as change_2021_2022, MAX(total_2022_2023) as total_2022_2023, MAX(total_2022) as total_2022, MAX(endowment_total_2022_2023) as endowment_total_2022_2023, MAX(endowment_total_2022) as endowment_total_2022, MAX(all_funds_total_2022_2023) as all_funds_total_2022_2023, MAX(all_funds_change_2022_2023) as all_funds_change_2022_2023, MAX(endowment_change_2022_2023) as endowment_change_2022_2023, MAX(change_2022_2023) as change_2022_2023, MAX(total_2023_2024) as total_2023_2024, MAX(total_2023) as total_2023, MAX(endowment_total_2023_2024) as endowment_total_2023_2024, MAX(endowment_total_2023) as endowment_total_2023, MAX(all_funds_total_2023_2024) as all_funds_total_2023_2024, MAX(all_funds_change_2023_2024) as all_funds_change_2023_2024, MAX(endowment_change_2023_2024) as endowment_change_2023_2024, MAX(change_2023_2024) as change_2023_2024, MAX(total_2024_2025) as total_2024_2025, MAX(total_2024) as total_2024, MAX(endowment_total_2024_2025) as endowment_total_2024_2025, MAX(endowment_total_2024) as endowment_total_2024, MAX(all_funds_total_2024_2025) as all_funds_total_2024_2025, MAX(all_funds_change_2024_2025) as all_funds_change_2024_2025, MAX(endowment_change_2024_2025) as endowment_change_2024_2025, MAX(change_2024_2025) as change_2024_2025, MAX(total_2025_2026) as total_2025_2026, MAX(total_2025) as total_2025, MAX(endowment_total_2025_2026) as endowment_total_2025_2026, MAX(endowment_total_2025) as endowment_total_2025, MAX(all_funds_total_2025_2026) as all_funds_total_2025_2026, MAX(all_funds_change_2025_2026) as all_funds_change_2025_2026, MAX(endowment_change_2025_2026) as endowment_change_2025_2026, MAX(change_2025_2026) as change_2025_2026

    FROM (
      SELECT
  CASE 

         WHEN (
         --  Major Donor  has given 10,000+ in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000

        ) THEN 100


         WHEN (
         --  Mid Tier  has given 1,000+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000

        ) THEN 200


         WHEN (
         --  Recurring donor  has made a recurring donation in last 36 months
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 400


         WHEN (
         --  Grassroots Plus Donor  has given 50+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50

        ) THEN 500


         WHEN (
         --  Grassroots Donor  has given in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 600


         WHEN (
         --  All other Donors  has given but not in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 300 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 300 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 900

       ELSE 1000
       END  as donor_segment_id, 
CASE

         WHEN (
         --  Active Recurring  gave recurring within last month
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 80


         WHEN (
         --  Delinquent Recurring  gave recurring more than 1 month & less than 4 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 3 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 3 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 85


         WHEN (
         --  Deep lapsed Recurring  gave recurring more than 6 months & less than 37 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 6 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 6 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 95


         WHEN (
         --  New  first donation this FY
         MIN(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 10


         WHEN (
         --  Consecutive  gave last financial year and this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 20


         WHEN (
         --  Active  gave in this FY
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 30


         WHEN (
         --  Lybunt  gave last financial year but NOT this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 35


         WHEN (
         --  Lapsed  last gave in the financial year before last
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 50


         WHEN (
         --  Deep Lapsed  last gave between 3 & 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2020-07-01 00:00:00')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 60


         WHEN (
         --  Ultra lapsed  gave prior to 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('1999-06-30 23:59:59') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 70

       ELSE 100
       END  as donor_status_id, MAX(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS largest_donation, MAX(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_largest_donation, MAX(COALESCE(total_amount, 0)) AS all_funds_largest_donation, SUM(COALESCE(total_amount, 0)) AS lifetime_including_endowment, SUM(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS lifetime_usd_total, SUM(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_lifetime_usd_total, MAX(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS last_donation_date, MAX(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_last_donation_date, MAX(IF(total_amount > 0, receive_date, NULL)) AS all_funds_last_donation_date, MIN(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS first_donation_date, MIN(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_first_donation_date, MIN(IF(total_amount > 0, receive_date, NULL)) AS all_funds_first_donation_date, COUNT(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS number_donations, COUNT(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_number_donations, COUNT(IF(total_amount > 0, receive_date, NULL)) AS all_funds_number_donations, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-07-01' AND '2007-06-30 23:59:59', c.total_amount, 0),0)) as total_2006_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-01-01' AND '2006-12-31 23:59:59', c.total_amount, 0),0)) as total_2006, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-07-01' AND '2008-06-30 23:59:59', c.total_amount, 0),0)) as total_2007_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-01-01' AND '2007-12-31 23:59:59', c.total_amount, 0),0)) as total_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-07-01' AND '2009-06-30 23:59:59', c.total_amount, 0),0)) as total_2008_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-01-01' AND '2008-12-31 23:59:59', c.total_amount, 0),0)) as total_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-07-01' AND '2010-06-30 23:59:59', c.total_amount, 0),0)) as total_2009_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-01-01' AND '2009-12-31 23:59:59', c.total_amount, 0),0)) as total_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-07-01' AND '2011-06-30 23:59:59', c.total_amount, 0),0)) as total_2010_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-01-01' AND '2010-12-31 23:59:59', c.total_amount, 0),0)) as total_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-07-01' AND '2012-06-30 23:59:59', c.total_amount, 0),0)) as total_2011_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-01-01' AND '2011-12-31 23:59:59', c.total_amount, 0),0)) as total_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-07-01' AND '2013-06-30 23:59:59', c.total_amount, 0),0)) as total_2012_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-01-01' AND '2012-12-31 23:59:59', c.total_amount, 0),0)) as total_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-07-01' AND '2014-06-30 23:59:59', c.total_amount, 0),0)) as total_2013_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-01-01' AND '2013-12-31 23:59:59', c.total_amount, 0),0)) as total_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-07-01' AND '2015-06-30 23:59:59', c.total_amount, 0),0)) as total_2014_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-01-01' AND '2014-12-31 23:59:59', c.total_amount, 0),0)) as total_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-07-01' AND '2016-06-30 23:59:59', c.total_amount, 0),0)) as total_2015_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-01-01' AND '2015-12-31 23:59:59', c.total_amount, 0),0)) as total_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-07-01' AND '2017-06-30 23:59:59', c.total_amount, 0),0)) as total_2016_2017, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-01-01' AND '2016-12-31 23:59:59', c.total_amount, 0),0)) as total_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-07-01' AND '2018-06-30 23:59:59', c.total_amount, 0),0)) as total_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0)) as total_2017, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0))
            as change_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as total_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2018_2019, SUM(COALESCE(IF(receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2018_2019, 
              SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2018_2019, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            as change_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as total_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2019_2020, SUM(COALESCE(IF(receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2019_2020, 
              SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2019_2020, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            as change_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as total_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2020_2021, SUM(COALESCE(IF(receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2020_2021, 
              SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2020_2021, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2020_2021, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            as change_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as total_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2021_2022, SUM(COALESCE(IF(receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2021_2022, 
              SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2021_2022, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2021_2022, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            as change_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as total_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2022_2023, SUM(COALESCE(IF(receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2022_2023, 
              SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2022_2023, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2022_2023, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            as change_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as total_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2023_2024, SUM(COALESCE(IF(receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2023_2024, 
              SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2023_2024, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2023_2024, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            as change_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as total_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2024_2025, SUM(COALESCE(IF(receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2024_2025, 
              SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2024_2025, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2024_2025, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            as change_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as total_2025_2026, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2025_2026, SUM(COALESCE(IF(receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2025_2026, 
              SUM(COALESCE(IF(receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2025_2026, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2025_2026, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            as change_2025_2026
      FROM civicrm_contribution c
      USE INDEX(FK_civicrm_contribution_contact_id)
      WHERE  contact_id = NEW.contact_id 
        AND contribution_status_id = 1
        AND (c.trxn_id NOT LIKE 'RFD %' OR c.trxn_id IS NULL)
    ) as totals

  LEFT JOIN civicrm_contribution latest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON latest.contact_id =  NEW.contact_id
    AND latest.receive_date = totals.last_donation_date
    AND latest.contribution_status_id = 1
    AND latest.total_amount > 0
    AND (latest.trxn_id NOT LIKE 'RFD %' OR latest.trxn_id IS NULL)
    AND latest.financial_type_id <> 26
  LEFT JOIN wmf_contribution_extra x ON x.entity_id = latest.id

  LEFT JOIN civicrm_contribution earliest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON earliest.contact_id =  NEW.contact_id
    AND earliest.receive_date = totals.first_donation_date
    AND earliest.contribution_status_id = 1
    AND earliest.total_amount > 0
    AND (earliest.trxn_id NOT LIKE 'RFD %' OR earliest.trxn_id IS NULL)

  LEFT JOIN civicrm_contribution largest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON largest.contact_id =  NEW.contact_id 
    AND largest.total_amount = totals.largest_donation
    AND largest.contribution_status_id = 1
    AND largest.total_amount > 0
    AND (largest.trxn_id NOT LIKE 'RFD %' OR largest.trxn_id IS NULL) GROUP BY  NEW.contact_id
     ON DUPLICATE KEY UPDATE
    donor_segment_id = VALUES(donor_segment_id), donor_status_id = VALUES(donor_status_id), last_donation_currency = VALUES(last_donation_currency), last_donation_amount = VALUES(last_donation_amount), last_donation_usd = VALUES(last_donation_usd), first_donation_usd = VALUES(first_donation_usd), date_of_largest_donation = VALUES(date_of_largest_donation), largest_donation = VALUES(largest_donation), endowment_largest_donation = VALUES(endowment_largest_donation), all_funds_largest_donation = VALUES(all_funds_largest_donation), lifetime_including_endowment = VALUES(lifetime_including_endowment), lifetime_usd_total = VALUES(lifetime_usd_total), endowment_lifetime_usd_total = VALUES(endowment_lifetime_usd_total), last_donation_date = VALUES(last_donation_date), endowment_last_donation_date = VALUES(endowment_last_donation_date), all_funds_last_donation_date = VALUES(all_funds_last_donation_date), first_donation_date = VALUES(first_donation_date), endowment_first_donation_date = VALUES(endowment_first_donation_date), all_funds_first_donation_date = VALUES(all_funds_first_donation_date), number_donations = VALUES(number_donations), endowment_number_donations = VALUES(endowment_number_donations), all_funds_number_donations = VALUES(all_funds_number_donations), total_2006_2007 = VALUES(total_2006_2007), total_2006 = VALUES(total_2006), total_2007_2008 = VALUES(total_2007_2008), total_2007 = VALUES(total_2007), total_2008_2009 = VALUES(total_2008_2009), total_2008 = VALUES(total_2008), total_2009_2010 = VALUES(total_2009_2010), total_2009 = VALUES(total_2009), total_2010_2011 = VALUES(total_2010_2011), total_2010 = VALUES(total_2010), total_2011_2012 = VALUES(total_2011_2012), total_2011 = VALUES(total_2011), total_2012_2013 = VALUES(total_2012_2013), total_2012 = VALUES(total_2012), total_2013_2014 = VALUES(total_2013_2014), total_2013 = VALUES(total_2013), total_2014_2015 = VALUES(total_2014_2015), total_2014 = VALUES(total_2014), total_2015_2016 = VALUES(total_2015_2016), total_2015 = VALUES(total_2015), total_2016_2017 = VALUES(total_2016_2017), total_2016 = VALUES(total_2016), total_2017_2018 = VALUES(total_2017_2018), total_2017 = VALUES(total_2017), change_2017_2018 = VALUES(change_2017_2018), total_2018_2019 = VALUES(total_2018_2019), total_2018 = VALUES(total_2018), endowment_total_2018_2019 = VALUES(endowment_total_2018_2019), endowment_total_2018 = VALUES(endowment_total_2018), all_funds_total_2018_2019 = VALUES(all_funds_total_2018_2019), all_funds_change_2018_2019 = VALUES(all_funds_change_2018_2019), change_2018_2019 = VALUES(change_2018_2019), total_2019_2020 = VALUES(total_2019_2020), total_2019 = VALUES(total_2019), endowment_total_2019_2020 = VALUES(endowment_total_2019_2020), endowment_total_2019 = VALUES(endowment_total_2019), all_funds_total_2019_2020 = VALUES(all_funds_total_2019_2020), all_funds_change_2019_2020 = VALUES(all_funds_change_2019_2020), change_2019_2020 = VALUES(change_2019_2020), total_2020_2021 = VALUES(total_2020_2021), total_2020 = VALUES(total_2020), endowment_total_2020_2021 = VALUES(endowment_total_2020_2021), endowment_total_2020 = VALUES(endowment_total_2020), all_funds_total_2020_2021 = VALUES(all_funds_total_2020_2021), all_funds_change_2020_2021 = VALUES(all_funds_change_2020_2021), endowment_change_2020_2021 = VALUES(endowment_change_2020_2021), change_2020_2021 = VALUES(change_2020_2021), total_2021_2022 = VALUES(total_2021_2022), total_2021 = VALUES(total_2021), endowment_total_2021_2022 = VALUES(endowment_total_2021_2022), endowment_total_2021 = VALUES(endowment_total_2021), all_funds_total_2021_2022 = VALUES(all_funds_total_2021_2022), all_funds_change_2021_2022 = VALUES(all_funds_change_2021_2022), endowment_change_2021_2022 = VALUES(endowment_change_2021_2022), change_2021_2022 = VALUES(change_2021_2022), total_2022_2023 = VALUES(total_2022_2023), total_2022 = VALUES(total_2022), endowment_total_2022_2023 = VALUES(endowment_total_2022_2023), endowment_total_2022 = VALUES(endowment_total_2022), all_funds_total_2022_2023 = VALUES(all_funds_total_2022_2023), all_funds_change_2022_2023 = VALUES(all_funds_change_2022_2023), endowment_change_2022_2023 = VALUES(endowment_change_2022_2023), change_2022_2023 = VALUES(change_2022_2023), total_2023_2024 = VALUES(total_2023_2024), total_2023 = VALUES(total_2023), endowment_total_2023_2024 = VALUES(endowment_total_2023_2024), endowment_total_2023 = VALUES(endowment_total_2023), all_funds_total_2023_2024 = VALUES(all_funds_total_2023_2024), all_funds_change_2023_2024 = VALUES(all_funds_change_2023_2024), endowment_change_2023_2024 = VALUES(endowment_change_2023_2024), change_2023_2024 = VALUES(change_2023_2024), total_2024_2025 = VALUES(total_2024_2025), total_2024 = VALUES(total_2024), endowment_total_2024_2025 = VALUES(endowment_total_2024_2025), endowment_total_2024 = VALUES(endowment_total_2024), all_funds_total_2024_2025 = VALUES(all_funds_total_2024_2025), all_funds_change_2024_2025 = VALUES(all_funds_change_2024_2025), endowment_change_2024_2025 = VALUES(endowment_change_2024_2025), change_2024_2025 = VALUES(change_2024_2025), total_2025_2026 = VALUES(total_2025_2026), total_2025 = VALUES(total_2025), endowment_total_2025_2026 = VALUES(endowment_total_2025_2026), endowment_total_2025 = VALUES(endowment_total_2025), all_funds_total_2025_2026 = VALUES(all_funds_total_2025_2026), all_funds_change_2025_2026 = VALUES(all_funds_change_2025_2026), endowment_change_2025_2026 = VALUES(endowment_change_2025_2026), change_2025_2026 = VALUES(change_2025_2026); END IF; 
 IF 1 AND (OLD.contact_id NOT IN (2123835,19855599,12513,72)) AND (NEW.contact_id <> OLD.contact_id) THEN
      INSERT INTO wmf_donor (
        entity_id, donor_segment_id, donor_status_id, last_donation_currency, last_donation_amount, last_donation_usd, first_donation_usd, date_of_largest_donation, largest_donation, endowment_largest_donation, all_funds_largest_donation, lifetime_including_endowment, lifetime_usd_total, endowment_lifetime_usd_total, last_donation_date, endowment_last_donation_date, all_funds_last_donation_date, first_donation_date, endowment_first_donation_date, all_funds_first_donation_date, number_donations, endowment_number_donations, all_funds_number_donations, total_2006_2007, total_2006, total_2007_2008, total_2007, total_2008_2009, total_2008, total_2009_2010, total_2009, total_2010_2011, total_2010, total_2011_2012, total_2011, total_2012_2013, total_2012, total_2013_2014, total_2013, total_2014_2015, total_2014, total_2015_2016, total_2015, total_2016_2017, total_2016, total_2017_2018, total_2017, change_2017_2018, total_2018_2019, total_2018, endowment_total_2018_2019, endowment_total_2018, all_funds_total_2018_2019, all_funds_change_2018_2019, change_2018_2019, total_2019_2020, total_2019, endowment_total_2019_2020, endowment_total_2019, all_funds_total_2019_2020, all_funds_change_2019_2020, change_2019_2020, total_2020_2021, total_2020, endowment_total_2020_2021, endowment_total_2020, all_funds_total_2020_2021, all_funds_change_2020_2021, endowment_change_2020_2021, change_2020_2021, total_2021_2022, total_2021, endowment_total_2021_2022, endowment_total_2021, all_funds_total_2021_2022, all_funds_change_2021_2022, endowment_change_2021_2022, change_2021_2022, total_2022_2023, total_2022, endowment_total_2022_2023, endowment_total_2022, all_funds_total_2022_2023, all_funds_change_2022_2023, endowment_change_2022_2023, change_2022_2023, total_2023_2024, total_2023, endowment_total_2023_2024, endowment_total_2023, all_funds_total_2023_2024, all_funds_change_2023_2024, endowment_change_2023_2024, change_2023_2024, total_2024_2025, total_2024, endowment_total_2024_2025, endowment_total_2024, all_funds_total_2024_2025, all_funds_change_2024_2025, endowment_change_2024_2025, change_2024_2025, total_2025_2026, total_2025, endowment_total_2025_2026, endowment_total_2025, all_funds_total_2025_2026, all_funds_change_2025_2026, endowment_change_2025_2026, change_2025_2026
      )SELECT
       OLD.contact_id as entity_id , # to honour FULL_GROUP_BY mysql mode we need an aggregate command for each
 # field - even though we know we just want `the value from the subquery`
 # MAX is a safe wrapper for that
 # https://www.percona.com/blog/2019/05/13/solve-query-failures-regarding-only_full_group_by-sql-mode/
 MAX(donor_segment_id) as donor_segment_id, MAX(donor_status_id) as donor_status_id, MAX(COALESCE(x.original_currency,
 latest.currency)) as last_donation_currency, MAX(COALESCE(x.original_amount,
 latest.total_amount,
 0)) as last_donation_amount, MAX(COALESCE(latest.total_amount,
 0)) as last_donation_usd, MAX(COALESCE(earliest.total_amount,
 0)) as first_donation_usd, MAX(largest.receive_date) as date_of_largest_donation, MAX(largest_donation) as largest_donation, MAX(endowment_largest_donation) as endowment_largest_donation, MAX(all_funds_largest_donation) as all_funds_largest_donation, MAX(lifetime_including_endowment) as lifetime_including_endowment, MAX(lifetime_usd_total) as lifetime_usd_total, MAX(endowment_lifetime_usd_total) as endowment_lifetime_usd_total, MAX(last_donation_date) as last_donation_date, MAX(endowment_last_donation_date) as endowment_last_donation_date, MAX(all_funds_last_donation_date) as all_funds_last_donation_date, MIN(first_donation_date) as first_donation_date, MIN(endowment_first_donation_date) as endowment_first_donation_date, MIN(all_funds_first_donation_date) as all_funds_first_donation_date, MAX(number_donations) as number_donations, MAX(endowment_number_donations) as endowment_number_donations, MAX(all_funds_number_donations) as all_funds_number_donations, MAX(total_2006_2007) as total_2006_2007, MAX(total_2006) as total_2006, MAX(total_2007_2008) as total_2007_2008, MAX(total_2007) as total_2007, MAX(total_2008_2009) as total_2008_2009, MAX(total_2008) as total_2008, MAX(total_2009_2010) as total_2009_2010, MAX(total_2009) as total_2009, MAX(total_2010_2011) as total_2010_2011, MAX(total_2010) as total_2010, MAX(total_2011_2012) as total_2011_2012, MAX(total_2011) as total_2011, MAX(total_2012_2013) as total_2012_2013, MAX(total_2012) as total_2012, MAX(total_2013_2014) as total_2013_2014, MAX(total_2013) as total_2013, MAX(total_2014_2015) as total_2014_2015, MAX(total_2014) as total_2014, MAX(total_2015_2016) as total_2015_2016, MAX(total_2015) as total_2015, MAX(total_2016_2017) as total_2016_2017, MAX(total_2016) as total_2016, MAX(total_2017_2018) as total_2017_2018, MAX(total_2017) as total_2017, MAX(change_2017_2018) as change_2017_2018, MAX(total_2018_2019) as total_2018_2019, MAX(total_2018) as total_2018, MAX(endowment_total_2018_2019) as endowment_total_2018_2019, MAX(endowment_total_2018) as endowment_total_2018, MAX(all_funds_total_2018_2019) as all_funds_total_2018_2019, MAX(all_funds_change_2018_2019) as all_funds_change_2018_2019, MAX(change_2018_2019) as change_2018_2019, MAX(total_2019_2020) as total_2019_2020, MAX(total_2019) as total_2019, MAX(endowment_total_2019_2020) as endowment_total_2019_2020, MAX(endowment_total_2019) as endowment_total_2019, MAX(all_funds_total_2019_2020) as all_funds_total_2019_2020, MAX(all_funds_change_2019_2020) as all_funds_change_2019_2020, MAX(change_2019_2020) as change_2019_2020, MAX(total_2020_2021) as total_2020_2021, MAX(total_2020) as total_2020, MAX(endowment_total_2020_2021) as endowment_total_2020_2021, MAX(endowment_total_2020) as endowment_total_2020, MAX(all_funds_total_2020_2021) as all_funds_total_2020_2021, MAX(all_funds_change_2020_2021) as all_funds_change_2020_2021, MAX(endowment_change_2020_2021) as endowment_change_2020_2021, MAX(change_2020_2021) as change_2020_2021, MAX(total_2021_2022) as total_2021_2022, MAX(total_2021) as total_2021, MAX(endowment_total_2021_2022) as endowment_total_2021_2022, MAX(endowment_total_2021) as endowment_total_2021, MAX(all_funds_total_2021_2022) as all_funds_total_2021_2022, MAX(all_funds_change_2021_2022) as all_funds_change_2021_2022, MAX(endowment_change_2021_2022) as endowment_change_2021_2022, MAX(change_2021_2022) as change_2021_2022, MAX(total_2022_2023) as total_2022_2023, MAX(total_2022) as total_2022, MAX(endowment_total_2022_2023) as endowment_total_2022_2023, MAX(endowment_total_2022) as endowment_total_2022, MAX(all_funds_total_2022_2023) as all_funds_total_2022_2023, MAX(all_funds_change_2022_2023) as all_funds_change_2022_2023, MAX(endowment_change_2022_2023) as endowment_change_2022_2023, MAX(change_2022_2023) as change_2022_2023, MAX(total_2023_2024) as total_2023_2024, MAX(total_2023) as total_2023, MAX(endowment_total_2023_2024) as endowment_total_2023_2024, MAX(endowment_total_2023) as endowment_total_2023, MAX(all_funds_total_2023_2024) as all_funds_total_2023_2024, MAX(all_funds_change_2023_2024) as all_funds_change_2023_2024, MAX(endowment_change_2023_2024) as endowment_change_2023_2024, MAX(change_2023_2024) as change_2023_2024, MAX(total_2024_2025) as total_2024_2025, MAX(total_2024) as total_2024, MAX(endowment_total_2024_2025) as endowment_total_2024_2025, MAX(endowment_total_2024) as endowment_total_2024, MAX(all_funds_total_2024_2025) as all_funds_total_2024_2025, MAX(all_funds_change_2024_2025) as all_funds_change_2024_2025, MAX(endowment_change_2024_2025) as endowment_change_2024_2025, MAX(change_2024_2025) as change_2024_2025, MAX(total_2025_2026) as total_2025_2026, MAX(total_2025) as total_2025, MAX(endowment_total_2025_2026) as endowment_total_2025_2026, MAX(endowment_total_2025) as endowment_total_2025, MAX(all_funds_total_2025_2026) as all_funds_total_2025_2026, MAX(all_funds_change_2025_2026) as all_funds_change_2025_2026, MAX(endowment_change_2025_2026) as endowment_change_2025_2026, MAX(change_2025_2026) as change_2025_2026

    FROM (
      SELECT
  CASE 

         WHEN (
         --  Major Donor  has given 10,000+ in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000

        ) THEN 100


         WHEN (
         --  Mid Tier  has given 1,000+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000

        ) THEN 200


         WHEN (
         --  Recurring donor  has made a recurring donation in last 36 months
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 400


         WHEN (
         --  Grassroots Plus Donor  has given 50+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50

        ) THEN 500


         WHEN (
         --  Grassroots Donor  has given in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 600


         WHEN (
         --  All other Donors  has given but not in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 300 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 300 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 900

       ELSE 1000
       END  as donor_segment_id, 
CASE

         WHEN (
         --  Active Recurring  gave recurring within last month
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 80


         WHEN (
         --  Delinquent Recurring  gave recurring more than 1 month & less than 4 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 3 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 3 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 85


         WHEN (
         --  Deep lapsed Recurring  gave recurring more than 6 months & less than 37 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 6 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 6 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 95


         WHEN (
         --  New  first donation this FY
         MIN(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 10


         WHEN (
         --  Consecutive  gave last financial year and this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 20


         WHEN (
         --  Active  gave in this FY
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 30


         WHEN (
         --  Lybunt  gave last financial year but NOT this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 35


         WHEN (
         --  Lapsed  last gave in the financial year before last
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 50


         WHEN (
         --  Deep Lapsed  last gave between 3 & 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2020-07-01 00:00:00')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 60


         WHEN (
         --  Ultra lapsed  gave prior to 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('1999-06-30 23:59:59') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 70

       ELSE 100
       END  as donor_status_id, MAX(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS largest_donation, MAX(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_largest_donation, MAX(COALESCE(total_amount, 0)) AS all_funds_largest_donation, SUM(COALESCE(total_amount, 0)) AS lifetime_including_endowment, SUM(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS lifetime_usd_total, SUM(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_lifetime_usd_total, MAX(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS last_donation_date, MAX(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_last_donation_date, MAX(IF(total_amount > 0, receive_date, NULL)) AS all_funds_last_donation_date, MIN(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS first_donation_date, MIN(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_first_donation_date, MIN(IF(total_amount > 0, receive_date, NULL)) AS all_funds_first_donation_date, COUNT(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS number_donations, COUNT(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_number_donations, COUNT(IF(total_amount > 0, receive_date, NULL)) AS all_funds_number_donations, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-07-01' AND '2007-06-30 23:59:59', c.total_amount, 0),0)) as total_2006_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-01-01' AND '2006-12-31 23:59:59', c.total_amount, 0),0)) as total_2006, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-07-01' AND '2008-06-30 23:59:59', c.total_amount, 0),0)) as total_2007_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-01-01' AND '2007-12-31 23:59:59', c.total_amount, 0),0)) as total_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-07-01' AND '2009-06-30 23:59:59', c.total_amount, 0),0)) as total_2008_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-01-01' AND '2008-12-31 23:59:59', c.total_amount, 0),0)) as total_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-07-01' AND '2010-06-30 23:59:59', c.total_amount, 0),0)) as total_2009_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-01-01' AND '2009-12-31 23:59:59', c.total_amount, 0),0)) as total_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-07-01' AND '2011-06-30 23:59:59', c.total_amount, 0),0)) as total_2010_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-01-01' AND '2010-12-31 23:59:59', c.total_amount, 0),0)) as total_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-07-01' AND '2012-06-30 23:59:59', c.total_amount, 0),0)) as total_2011_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-01-01' AND '2011-12-31 23:59:59', c.total_amount, 0),0)) as total_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-07-01' AND '2013-06-30 23:59:59', c.total_amount, 0),0)) as total_2012_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-01-01' AND '2012-12-31 23:59:59', c.total_amount, 0),0)) as total_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-07-01' AND '2014-06-30 23:59:59', c.total_amount, 0),0)) as total_2013_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-01-01' AND '2013-12-31 23:59:59', c.total_amount, 0),0)) as total_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-07-01' AND '2015-06-30 23:59:59', c.total_amount, 0),0)) as total_2014_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-01-01' AND '2014-12-31 23:59:59', c.total_amount, 0),0)) as total_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-07-01' AND '2016-06-30 23:59:59', c.total_amount, 0),0)) as total_2015_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-01-01' AND '2015-12-31 23:59:59', c.total_amount, 0),0)) as total_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-07-01' AND '2017-06-30 23:59:59', c.total_amount, 0),0)) as total_2016_2017, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-01-01' AND '2016-12-31 23:59:59', c.total_amount, 0),0)) as total_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-07-01' AND '2018-06-30 23:59:59', c.total_amount, 0),0)) as total_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0)) as total_2017, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0))
            as change_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as total_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2018_2019, SUM(COALESCE(IF(receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2018_2019, 
              SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2018_2019, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            as change_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as total_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2019_2020, SUM(COALESCE(IF(receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2019_2020, 
              SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2019_2020, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            as change_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as total_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2020_2021, SUM(COALESCE(IF(receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2020_2021, 
              SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2020_2021, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2020_2021, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            as change_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as total_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2021_2022, SUM(COALESCE(IF(receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2021_2022, 
              SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2021_2022, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2021_2022, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            as change_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as total_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2022_2023, SUM(COALESCE(IF(receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2022_2023, 
              SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2022_2023, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2022_2023, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            as change_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as total_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2023_2024, SUM(COALESCE(IF(receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2023_2024, 
              SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2023_2024, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2023_2024, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            as change_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as total_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2024_2025, SUM(COALESCE(IF(receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2024_2025, 
              SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2024_2025, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2024_2025, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            as change_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as total_2025_2026, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2025_2026, SUM(COALESCE(IF(receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2025_2026, 
              SUM(COALESCE(IF(receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2025_2026, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2025_2026, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            as change_2025_2026
      FROM civicrm_contribution c
      USE INDEX(FK_civicrm_contribution_contact_id)
      WHERE  contact_id = OLD.contact_id 
        AND contribution_status_id = 1
        AND (c.trxn_id NOT LIKE 'RFD %' OR c.trxn_id IS NULL)
    ) as totals

  LEFT JOIN civicrm_contribution latest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON latest.contact_id =  OLD.contact_id
    AND latest.receive_date = totals.last_donation_date
    AND latest.contribution_status_id = 1
    AND latest.total_amount > 0
    AND (latest.trxn_id NOT LIKE 'RFD %' OR latest.trxn_id IS NULL)
    AND latest.financial_type_id <> 26
  LEFT JOIN wmf_contribution_extra x ON x.entity_id = latest.id

  LEFT JOIN civicrm_contribution earliest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON earliest.contact_id =  OLD.contact_id
    AND earliest.receive_date = totals.first_donation_date
    AND earliest.contribution_status_id = 1
    AND earliest.total_amount > 0
    AND (earliest.trxn_id NOT LIKE 'RFD %' OR earliest.trxn_id IS NULL)

  LEFT JOIN civicrm_contribution largest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON largest.contact_id =  OLD.contact_id 
    AND largest.total_amount = totals.largest_donation
    AND largest.contribution_status_id = 1
    AND largest.total_amount > 0
    AND (largest.trxn_id NOT LIKE 'RFD %' OR largest.trxn_id IS NULL) GROUP BY  OLD.contact_id
     ON DUPLICATE KEY UPDATE
    donor_segment_id = VALUES(donor_segment_id), donor_status_id = VALUES(donor_status_id), last_donation_currency = VALUES(last_donation_currency), last_donation_amount = VALUES(last_donation_amount), last_donation_usd = VALUES(last_donation_usd), first_donation_usd = VALUES(first_donation_usd), date_of_largest_donation = VALUES(date_of_largest_donation), largest_donation = VALUES(largest_donation), endowment_largest_donation = VALUES(endowment_largest_donation), all_funds_largest_donation = VALUES(all_funds_largest_donation), lifetime_including_endowment = VALUES(lifetime_including_endowment), lifetime_usd_total = VALUES(lifetime_usd_total), endowment_lifetime_usd_total = VALUES(endowment_lifetime_usd_total), last_donation_date = VALUES(last_donation_date), endowment_last_donation_date = VALUES(endowment_last_donation_date), all_funds_last_donation_date = VALUES(all_funds_last_donation_date), first_donation_date = VALUES(first_donation_date), endowment_first_donation_date = VALUES(endowment_first_donation_date), all_funds_first_donation_date = VALUES(all_funds_first_donation_date), number_donations = VALUES(number_donations), endowment_number_donations = VALUES(endowment_number_donations), all_funds_number_donations = VALUES(all_funds_number_donations), total_2006_2007 = VALUES(total_2006_2007), total_2006 = VALUES(total_2006), total_2007_2008 = VALUES(total_2007_2008), total_2007 = VALUES(total_2007), total_2008_2009 = VALUES(total_2008_2009), total_2008 = VALUES(total_2008), total_2009_2010 = VALUES(total_2009_2010), total_2009 = VALUES(total_2009), total_2010_2011 = VALUES(total_2010_2011), total_2010 = VALUES(total_2010), total_2011_2012 = VALUES(total_2011_2012), total_2011 = VALUES(total_2011), total_2012_2013 = VALUES(total_2012_2013), total_2012 = VALUES(total_2012), total_2013_2014 = VALUES(total_2013_2014), total_2013 = VALUES(total_2013), total_2014_2015 = VALUES(total_2014_2015), total_2014 = VALUES(total_2014), total_2015_2016 = VALUES(total_2015_2016), total_2015 = VALUES(total_2015), total_2016_2017 = VALUES(total_2016_2017), total_2016 = VALUES(total_2016), total_2017_2018 = VALUES(total_2017_2018), total_2017 = VALUES(total_2017), change_2017_2018 = VALUES(change_2017_2018), total_2018_2019 = VALUES(total_2018_2019), total_2018 = VALUES(total_2018), endowment_total_2018_2019 = VALUES(endowment_total_2018_2019), endowment_total_2018 = VALUES(endowment_total_2018), all_funds_total_2018_2019 = VALUES(all_funds_total_2018_2019), all_funds_change_2018_2019 = VALUES(all_funds_change_2018_2019), change_2018_2019 = VALUES(change_2018_2019), total_2019_2020 = VALUES(total_2019_2020), total_2019 = VALUES(total_2019), endowment_total_2019_2020 = VALUES(endowment_total_2019_2020), endowment_total_2019 = VALUES(endowment_total_2019), all_funds_total_2019_2020 = VALUES(all_funds_total_2019_2020), all_funds_change_2019_2020 = VALUES(all_funds_change_2019_2020), change_2019_2020 = VALUES(change_2019_2020), total_2020_2021 = VALUES(total_2020_2021), total_2020 = VALUES(total_2020), endowment_total_2020_2021 = VALUES(endowment_total_2020_2021), endowment_total_2020 = VALUES(endowment_total_2020), all_funds_total_2020_2021 = VALUES(all_funds_total_2020_2021), all_funds_change_2020_2021 = VALUES(all_funds_change_2020_2021), endowment_change_2020_2021 = VALUES(endowment_change_2020_2021), change_2020_2021 = VALUES(change_2020_2021), total_2021_2022 = VALUES(total_2021_2022), total_2021 = VALUES(total_2021), endowment_total_2021_2022 = VALUES(endowment_total_2021_2022), endowment_total_2021 = VALUES(endowment_total_2021), all_funds_total_2021_2022 = VALUES(all_funds_total_2021_2022), all_funds_change_2021_2022 = VALUES(all_funds_change_2021_2022), endowment_change_2021_2022 = VALUES(endowment_change_2021_2022), change_2021_2022 = VALUES(change_2021_2022), total_2022_2023 = VALUES(total_2022_2023), total_2022 = VALUES(total_2022), endowment_total_2022_2023 = VALUES(endowment_total_2022_2023), endowment_total_2022 = VALUES(endowment_total_2022), all_funds_total_2022_2023 = VALUES(all_funds_total_2022_2023), all_funds_change_2022_2023 = VALUES(all_funds_change_2022_2023), endowment_change_2022_2023 = VALUES(endowment_change_2022_2023), change_2022_2023 = VALUES(change_2022_2023), total_2023_2024 = VALUES(total_2023_2024), total_2023 = VALUES(total_2023), endowment_total_2023_2024 = VALUES(endowment_total_2023_2024), endowment_total_2023 = VALUES(endowment_total_2023), all_funds_total_2023_2024 = VALUES(all_funds_total_2023_2024), all_funds_change_2023_2024 = VALUES(all_funds_change_2023_2024), endowment_change_2023_2024 = VALUES(endowment_change_2023_2024), change_2023_2024 = VALUES(change_2023_2024), total_2024_2025 = VALUES(total_2024_2025), total_2024 = VALUES(total_2024), endowment_total_2024_2025 = VALUES(endowment_total_2024_2025), endowment_total_2024 = VALUES(endowment_total_2024), all_funds_total_2024_2025 = VALUES(all_funds_total_2024_2025), all_funds_change_2024_2025 = VALUES(all_funds_change_2024_2025), endowment_change_2024_2025 = VALUES(endowment_change_2024_2025), change_2024_2025 = VALUES(change_2024_2025), total_2025_2026 = VALUES(total_2025_2026), total_2025 = VALUES(total_2025), endowment_total_2025_2026 = VALUES(endowment_total_2025_2026), endowment_total_2025 = VALUES(endowment_total_2025), all_funds_total_2025_2026 = VALUES(all_funds_total_2025_2026), all_funds_change_2025_2026 = VALUES(all_funds_change_2025_2026), endowment_change_2025_2026 = VALUES(endowment_change_2025_2026), change_2025_2026 = VALUES(change_2025_2026); END IF;  END //

CREATE TRIGGER civicrm_contribution_after_delete after delete ON civicrm_contribution FOR EACH ROW BEGIN   IF 1 AND (OLD.contact_id NOT IN (2123835,19855599,12513,72)) THEN
      INSERT INTO wmf_donor (
        entity_id, donor_segment_id, donor_status_id, last_donation_currency, last_donation_amount, last_donation_usd, first_donation_usd, date_of_largest_donation, largest_donation, endowment_largest_donation, all_funds_largest_donation, lifetime_including_endowment, lifetime_usd_total, endowment_lifetime_usd_total, last_donation_date, endowment_last_donation_date, all_funds_last_donation_date, first_donation_date, endowment_first_donation_date, all_funds_first_donation_date, number_donations, endowment_number_donations, all_funds_number_donations, total_2006_2007, total_2006, total_2007_2008, total_2007, total_2008_2009, total_2008, total_2009_2010, total_2009, total_2010_2011, total_2010, total_2011_2012, total_2011, total_2012_2013, total_2012, total_2013_2014, total_2013, total_2014_2015, total_2014, total_2015_2016, total_2015, total_2016_2017, total_2016, total_2017_2018, total_2017, change_2017_2018, total_2018_2019, total_2018, endowment_total_2018_2019, endowment_total_2018, all_funds_total_2018_2019, all_funds_change_2018_2019, change_2018_2019, total_2019_2020, total_2019, endowment_total_2019_2020, endowment_total_2019, all_funds_total_2019_2020, all_funds_change_2019_2020, change_2019_2020, total_2020_2021, total_2020, endowment_total_2020_2021, endowment_total_2020, all_funds_total_2020_2021, all_funds_change_2020_2021, endowment_change_2020_2021, change_2020_2021, total_2021_2022, total_2021, endowment_total_2021_2022, endowment_total_2021, all_funds_total_2021_2022, all_funds_change_2021_2022, endowment_change_2021_2022, change_2021_2022, total_2022_2023, total_2022, endowment_total_2022_2023, endowment_total_2022, all_funds_total_2022_2023, all_funds_change_2022_2023, endowment_change_2022_2023, change_2022_2023, total_2023_2024, total_2023, endowment_total_2023_2024, endowment_total_2023, all_funds_total_2023_2024, all_funds_change_2023_2024, endowment_change_2023_2024, change_2023_2024, total_2024_2025, total_2024, endowment_total_2024_2025, endowment_total_2024, all_funds_total_2024_2025, all_funds_change_2024_2025, endowment_change_2024_2025, change_2024_2025, total_2025_2026, total_2025, endowment_total_2025_2026, endowment_total_2025, all_funds_total_2025_2026, all_funds_change_2025_2026, endowment_change_2025_2026, change_2025_2026
      )SELECT
       OLD.contact_id as entity_id , # to honour FULL_GROUP_BY mysql mode we need an aggregate command for each
 # field - even though we know we just want `the value from the subquery`
 # MAX is a safe wrapper for that
 # https://www.percona.com/blog/2019/05/13/solve-query-failures-regarding-only_full_group_by-sql-mode/
 MAX(donor_segment_id) as donor_segment_id, MAX(donor_status_id) as donor_status_id, MAX(COALESCE(x.original_currency,
 latest.currency)) as last_donation_currency, MAX(COALESCE(x.original_amount,
 latest.total_amount,
 0)) as last_donation_amount, MAX(COALESCE(latest.total_amount,
 0)) as last_donation_usd, MAX(COALESCE(earliest.total_amount,
 0)) as first_donation_usd, MAX(largest.receive_date) as date_of_largest_donation, MAX(largest_donation) as largest_donation, MAX(endowment_largest_donation) as endowment_largest_donation, MAX(all_funds_largest_donation) as all_funds_largest_donation, MAX(lifetime_including_endowment) as lifetime_including_endowment, MAX(lifetime_usd_total) as lifetime_usd_total, MAX(endowment_lifetime_usd_total) as endowment_lifetime_usd_total, MAX(last_donation_date) as last_donation_date, MAX(endowment_last_donation_date) as endowment_last_donation_date, MAX(all_funds_last_donation_date) as all_funds_last_donation_date, MIN(first_donation_date) as first_donation_date, MIN(endowment_first_donation_date) as endowment_first_donation_date, MIN(all_funds_first_donation_date) as all_funds_first_donation_date, MAX(number_donations) as number_donations, MAX(endowment_number_donations) as endowment_number_donations, MAX(all_funds_number_donations) as all_funds_number_donations, MAX(total_2006_2007) as total_2006_2007, MAX(total_2006) as total_2006, MAX(total_2007_2008) as total_2007_2008, MAX(total_2007) as total_2007, MAX(total_2008_2009) as total_2008_2009, MAX(total_2008) as total_2008, MAX(total_2009_2010) as total_2009_2010, MAX(total_2009) as total_2009, MAX(total_2010_2011) as total_2010_2011, MAX(total_2010) as total_2010, MAX(total_2011_2012) as total_2011_2012, MAX(total_2011) as total_2011, MAX(total_2012_2013) as total_2012_2013, MAX(total_2012) as total_2012, MAX(total_2013_2014) as total_2013_2014, MAX(total_2013) as total_2013, MAX(total_2014_2015) as total_2014_2015, MAX(total_2014) as total_2014, MAX(total_2015_2016) as total_2015_2016, MAX(total_2015) as total_2015, MAX(total_2016_2017) as total_2016_2017, MAX(total_2016) as total_2016, MAX(total_2017_2018) as total_2017_2018, MAX(total_2017) as total_2017, MAX(change_2017_2018) as change_2017_2018, MAX(total_2018_2019) as total_2018_2019, MAX(total_2018) as total_2018, MAX(endowment_total_2018_2019) as endowment_total_2018_2019, MAX(endowment_total_2018) as endowment_total_2018, MAX(all_funds_total_2018_2019) as all_funds_total_2018_2019, MAX(all_funds_change_2018_2019) as all_funds_change_2018_2019, MAX(change_2018_2019) as change_2018_2019, MAX(total_2019_2020) as total_2019_2020, MAX(total_2019) as total_2019, MAX(endowment_total_2019_2020) as endowment_total_2019_2020, MAX(endowment_total_2019) as endowment_total_2019, MAX(all_funds_total_2019_2020) as all_funds_total_2019_2020, MAX(all_funds_change_2019_2020) as all_funds_change_2019_2020, MAX(change_2019_2020) as change_2019_2020, MAX(total_2020_2021) as total_2020_2021, MAX(total_2020) as total_2020, MAX(endowment_total_2020_2021) as endowment_total_2020_2021, MAX(endowment_total_2020) as endowment_total_2020, MAX(all_funds_total_2020_2021) as all_funds_total_2020_2021, MAX(all_funds_change_2020_2021) as all_funds_change_2020_2021, MAX(endowment_change_2020_2021) as endowment_change_2020_2021, MAX(change_2020_2021) as change_2020_2021, MAX(total_2021_2022) as total_2021_2022, MAX(total_2021) as total_2021, MAX(endowment_total_2021_2022) as endowment_total_2021_2022, MAX(endowment_total_2021) as endowment_total_2021, MAX(all_funds_total_2021_2022) as all_funds_total_2021_2022, MAX(all_funds_change_2021_2022) as all_funds_change_2021_2022, MAX(endowment_change_2021_2022) as endowment_change_2021_2022, MAX(change_2021_2022) as change_2021_2022, MAX(total_2022_2023) as total_2022_2023, MAX(total_2022) as total_2022, MAX(endowment_total_2022_2023) as endowment_total_2022_2023, MAX(endowment_total_2022) as endowment_total_2022, MAX(all_funds_total_2022_2023) as all_funds_total_2022_2023, MAX(all_funds_change_2022_2023) as all_funds_change_2022_2023, MAX(endowment_change_2022_2023) as endowment_change_2022_2023, MAX(change_2022_2023) as change_2022_2023, MAX(total_2023_2024) as total_2023_2024, MAX(total_2023) as total_2023, MAX(endowment_total_2023_2024) as endowment_total_2023_2024, MAX(endowment_total_2023) as endowment_total_2023, MAX(all_funds_total_2023_2024) as all_funds_total_2023_2024, MAX(all_funds_change_2023_2024) as all_funds_change_2023_2024, MAX(endowment_change_2023_2024) as endowment_change_2023_2024, MAX(change_2023_2024) as change_2023_2024, MAX(total_2024_2025) as total_2024_2025, MAX(total_2024) as total_2024, MAX(endowment_total_2024_2025) as endowment_total_2024_2025, MAX(endowment_total_2024) as endowment_total_2024, MAX(all_funds_total_2024_2025) as all_funds_total_2024_2025, MAX(all_funds_change_2024_2025) as all_funds_change_2024_2025, MAX(endowment_change_2024_2025) as endowment_change_2024_2025, MAX(change_2024_2025) as change_2024_2025, MAX(total_2025_2026) as total_2025_2026, MAX(total_2025) as total_2025, MAX(endowment_total_2025_2026) as endowment_total_2025_2026, MAX(endowment_total_2025) as endowment_total_2025, MAX(all_funds_total_2025_2026) as all_funds_total_2025_2026, MAX(all_funds_change_2025_2026) as all_funds_change_2025_2026, MAX(endowment_change_2025_2026) as endowment_change_2025_2026, MAX(change_2025_2026) as change_2025_2026

    FROM (
      SELECT
  CASE 

         WHEN (
         --  Major Donor  has given 10,000+ in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 10000

        ) THEN 100


         WHEN (
         --  Mid Tier  has given 1,000+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 1000

        ) THEN 200


         WHEN (
         --  Recurring donor  has made a recurring donation in last 36 months
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 400


         WHEN (
         --  Grassroots Plus Donor  has given 50+  in one of the past 5 financial years, or in the current financial year so far
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50 OR SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 50

        ) THEN 500


         WHEN (
         --  Grassroots Donor  has given in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 600


         WHEN (
         --  All other Donors  has given but not in the last 5 financial years (or the current one)
         SUM(COALESCE(IF( receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 300 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 300 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 900

       ELSE 1000
       END  as donor_segment_id, 
CASE

         WHEN (
         --  Active Recurring  gave recurring within last month
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH)) AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 80


         WHEN (
         --  Delinquent Recurring  gave recurring more than 1 month & less than 4 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 3 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 3 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 1 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 1 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 85


         WHEN (
         --  Deep lapsed Recurring  gave recurring more than 6 months & less than 37 months ago
         SUM(COALESCE(IF(contribution_recur_id IS NOT NULL AND  receive_date
      BETWEEN (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 36 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 36 MONTH)) AND (IF (NOW() < '2024-06-30 23:59:59.9999', NOW() - INTERVAL 6 MONTH, '2024-06-30 23:59:59.9999' - INTERVAL 6 MONTH))
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2020-07-01 00:00:00') AND ('2021-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2019-07-01 00:00:00') AND ('2020-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) < 1000

        ) THEN 95


         WHEN (
         --  New  first donation this FY
         MIN(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 10


         WHEN (
         --  Consecutive  gave last financial year and this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01 AND SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 20


         WHEN (
         --  Active  gave in this FY
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2023-07-01 00:00:00') AND ('2024-06-30 23:59:59.9999')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 30


         WHEN (
         --  Lybunt  gave last financial year but NOT this financial year to date
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2022-07-01 00:00:00') AND ('2023-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 35


         WHEN (
         --  Lapsed  last gave in the financial year before last
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2021-07-01 00:00:00') AND ('2022-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 50


         WHEN (
         --  Deep Lapsed  last gave between 3 & 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('2018-07-01 00:00:00') AND ('2020-07-01 00:00:00')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 60


         WHEN (
         --  Ultra lapsed  gave prior to 5 financial years ago
         SUM(COALESCE(IF( receive_date
      BETWEEN ('1999-06-30 23:59:59') AND ('2019-06-30 23:59:59')
      , total_amount, 0), 0)) >= 0.01

        ) THEN 70

       ELSE 100
       END  as donor_status_id, MAX(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS largest_donation, MAX(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_largest_donation, MAX(COALESCE(total_amount, 0)) AS all_funds_largest_donation, SUM(COALESCE(total_amount, 0)) AS lifetime_including_endowment, SUM(IF(financial_type_id <> 26, COALESCE(total_amount, 0), 0)) AS lifetime_usd_total, SUM(IF(financial_type_id = 26, COALESCE(total_amount, 0), 0)) AS endowment_lifetime_usd_total, MAX(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS last_donation_date, MAX(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_last_donation_date, MAX(IF(total_amount > 0, receive_date, NULL)) AS all_funds_last_donation_date, MIN(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS first_donation_date, MIN(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_first_donation_date, MIN(IF(total_amount > 0, receive_date, NULL)) AS all_funds_first_donation_date, COUNT(IF(financial_type_id <> 26 AND total_amount > 0, receive_date, NULL)) AS number_donations, COUNT(IF(financial_type_id = 26 AND total_amount > 0, receive_date, NULL)) AS endowment_number_donations, COUNT(IF(total_amount > 0, receive_date, NULL)) AS all_funds_number_donations, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-07-01' AND '2007-06-30 23:59:59', c.total_amount, 0),0)) as total_2006_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2006-01-01' AND '2006-12-31 23:59:59', c.total_amount, 0),0)) as total_2006, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-07-01' AND '2008-06-30 23:59:59', c.total_amount, 0),0)) as total_2007_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2007-01-01' AND '2007-12-31 23:59:59', c.total_amount, 0),0)) as total_2007, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-07-01' AND '2009-06-30 23:59:59', c.total_amount, 0),0)) as total_2008_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2008-01-01' AND '2008-12-31 23:59:59', c.total_amount, 0),0)) as total_2008, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-07-01' AND '2010-06-30 23:59:59', c.total_amount, 0),0)) as total_2009_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2009-01-01' AND '2009-12-31 23:59:59', c.total_amount, 0),0)) as total_2009, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-07-01' AND '2011-06-30 23:59:59', c.total_amount, 0),0)) as total_2010_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2010-01-01' AND '2010-12-31 23:59:59', c.total_amount, 0),0)) as total_2010, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-07-01' AND '2012-06-30 23:59:59', c.total_amount, 0),0)) as total_2011_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2011-01-01' AND '2011-12-31 23:59:59', c.total_amount, 0),0)) as total_2011, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-07-01' AND '2013-06-30 23:59:59', c.total_amount, 0),0)) as total_2012_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2012-01-01' AND '2012-12-31 23:59:59', c.total_amount, 0),0)) as total_2012, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-07-01' AND '2014-06-30 23:59:59', c.total_amount, 0),0)) as total_2013_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2013-01-01' AND '2013-12-31 23:59:59', c.total_amount, 0),0)) as total_2013, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-07-01' AND '2015-06-30 23:59:59', c.total_amount, 0),0)) as total_2014_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2014-01-01' AND '2014-12-31 23:59:59', c.total_amount, 0),0)) as total_2014, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-07-01' AND '2016-06-30 23:59:59', c.total_amount, 0),0)) as total_2015_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2015-01-01' AND '2015-12-31 23:59:59', c.total_amount, 0),0)) as total_2015, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-07-01' AND '2017-06-30 23:59:59', c.total_amount, 0),0)) as total_2016_2017, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2016-01-01' AND '2016-12-31 23:59:59', c.total_amount, 0),0)) as total_2016, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-07-01' AND '2018-06-30 23:59:59', c.total_amount, 0),0)) as total_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0)) as total_2017, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2017-01-01' AND '2017-12-31 23:59:59', c.total_amount, 0),0))
            as change_2017_2018, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as total_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2018, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2018_2019, SUM(COALESCE(IF(receive_date BETWEEN '2018-07-01' AND '2019-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2018_2019, 
              SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2018_2019, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2018-01-01' AND '2018-12-31 23:59:59', c.total_amount, 0),0))
            as change_2018_2019, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as total_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2019, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2019_2020, SUM(COALESCE(IF(receive_date BETWEEN '2019-07-01' AND '2020-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2019_2020, 
              SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2019_2020, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2019-01-01' AND '2019-12-31 23:59:59', c.total_amount, 0),0))
            as change_2019_2020, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as total_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2020, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2020_2021, SUM(COALESCE(IF(receive_date BETWEEN '2020-07-01' AND '2021-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2020_2021, 
              SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2020_2021, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2020_2021, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2020-01-01' AND '2020-12-31 23:59:59', c.total_amount, 0),0))
            as change_2020_2021, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as total_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2021, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2021_2022, SUM(COALESCE(IF(receive_date BETWEEN '2021-07-01' AND '2022-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2021_2022, 
              SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2021_2022, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2021_2022, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2021-01-01' AND '2021-12-31 23:59:59', c.total_amount, 0),0))
            as change_2021_2022, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as total_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2022, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2022_2023, SUM(COALESCE(IF(receive_date BETWEEN '2022-07-01' AND '2023-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2022_2023, 
              SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2022_2023, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2022_2023, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2022-01-01' AND '2022-12-31 23:59:59', c.total_amount, 0),0))
            as change_2022_2023, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as total_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2023, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2023_2024, SUM(COALESCE(IF(receive_date BETWEEN '2023-07-01' AND '2024-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2023_2024, 
              SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2023_2024, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2023_2024, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2023-01-01' AND '2023-12-31 23:59:59', c.total_amount, 0),0))
            as change_2023_2024, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as total_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2024, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2024_2025, SUM(COALESCE(IF(receive_date BETWEEN '2024-07-01' AND '2025-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2024_2025, 
              SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2024_2025, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2024_2025, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2024-01-01' AND '2024-12-31 23:59:59', c.total_amount, 0),0))
            as change_2024_2025, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as total_2025_2026, SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0)) as endowment_total_2025, SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as endowment_total_2025_2026, SUM(COALESCE(IF(receive_date BETWEEN '2025-07-01' AND '2026-06-30 23:59:59', c.total_amount, 0),0)) as all_funds_total_2025_2026, 
              SUM(COALESCE(IF(receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as all_funds_change_2025_2026, 
               SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
              - SUM(COALESCE(IF(financial_type_id = 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
               as endowment_change_2025_2026, 
            SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2026-01-01' AND '2026-12-31 23:59:59', c.total_amount, 0),0))
            - SUM(COALESCE(IF(financial_type_id <> 26 AND receive_date BETWEEN '2025-01-01' AND '2025-12-31 23:59:59', c.total_amount, 0),0))
            as change_2025_2026
      FROM civicrm_contribution c
      USE INDEX(FK_civicrm_contribution_contact_id)
      WHERE  contact_id = OLD.contact_id 
        AND contribution_status_id = 1
        AND (c.trxn_id NOT LIKE 'RFD %' OR c.trxn_id IS NULL)
    ) as totals

  LEFT JOIN civicrm_contribution latest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON latest.contact_id =  OLD.contact_id
    AND latest.receive_date = totals.last_donation_date
    AND latest.contribution_status_id = 1
    AND latest.total_amount > 0
    AND (latest.trxn_id NOT LIKE 'RFD %' OR latest.trxn_id IS NULL)
    AND latest.financial_type_id <> 26
  LEFT JOIN wmf_contribution_extra x ON x.entity_id = latest.id

  LEFT JOIN civicrm_contribution earliest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON earliest.contact_id =  OLD.contact_id
    AND earliest.receive_date = totals.first_donation_date
    AND earliest.contribution_status_id = 1
    AND earliest.total_amount > 0
    AND (earliest.trxn_id NOT LIKE 'RFD %' OR earliest.trxn_id IS NULL)

  LEFT JOIN civicrm_contribution largest
    USE INDEX(FK_civicrm_contribution_contact_id)
    ON largest.contact_id =  OLD.contact_id 
    AND largest.total_amount = totals.largest_donation
    AND largest.contribution_status_id = 1
    AND largest.total_amount > 0
    AND (largest.trxn_id NOT LIKE 'RFD %' OR largest.trxn_id IS NULL) GROUP BY  OLD.contact_id
     ON DUPLICATE KEY UPDATE
    donor_segment_id = VALUES(donor_segment_id), donor_status_id = VALUES(donor_status_id), last_donation_currency = VALUES(last_donation_currency), last_donation_amount = VALUES(last_donation_amount), last_donation_usd = VALUES(last_donation_usd), first_donation_usd = VALUES(first_donation_usd), date_of_largest_donation = VALUES(date_of_largest_donation), largest_donation = VALUES(largest_donation), endowment_largest_donation = VALUES(endowment_largest_donation), all_funds_largest_donation = VALUES(all_funds_largest_donation), lifetime_including_endowment = VALUES(lifetime_including_endowment), lifetime_usd_total = VALUES(lifetime_usd_total), endowment_lifetime_usd_total = VALUES(endowment_lifetime_usd_total), last_donation_date = VALUES(last_donation_date), endowment_last_donation_date = VALUES(endowment_last_donation_date), all_funds_last_donation_date = VALUES(all_funds_last_donation_date), first_donation_date = VALUES(first_donation_date), endowment_first_donation_date = VALUES(endowment_first_donation_date), all_funds_first_donation_date = VALUES(all_funds_first_donation_date), number_donations = VALUES(number_donations), endowment_number_donations = VALUES(endowment_number_donations), all_funds_number_donations = VALUES(all_funds_number_donations), total_2006_2007 = VALUES(total_2006_2007), total_2006 = VALUES(total_2006), total_2007_2008 = VALUES(total_2007_2008), total_2007 = VALUES(total_2007), total_2008_2009 = VALUES(total_2008_2009), total_2008 = VALUES(total_2008), total_2009_2010 = VALUES(total_2009_2010), total_2009 = VALUES(total_2009), total_2010_2011 = VALUES(total_2010_2011), total_2010 = VALUES(total_2010), total_2011_2012 = VALUES(total_2011_2012), total_2011 = VALUES(total_2011), total_2012_2013 = VALUES(total_2012_2013), total_2012 = VALUES(total_2012), total_2013_2014 = VALUES(total_2013_2014), total_2013 = VALUES(total_2013), total_2014_2015 = VALUES(total_2014_2015), total_2014 = VALUES(total_2014), total_2015_2016 = VALUES(total_2015_2016), total_2015 = VALUES(total_2015), total_2016_2017 = VALUES(total_2016_2017), total_2016 = VALUES(total_2016), total_2017_2018 = VALUES(total_2017_2018), total_2017 = VALUES(total_2017), change_2017_2018 = VALUES(change_2017_2018), total_2018_2019 = VALUES(total_2018_2019), total_2018 = VALUES(total_2018), endowment_total_2018_2019 = VALUES(endowment_total_2018_2019), endowment_total_2018 = VALUES(endowment_total_2018), all_funds_total_2018_2019 = VALUES(all_funds_total_2018_2019), all_funds_change_2018_2019 = VALUES(all_funds_change_2018_2019), change_2018_2019 = VALUES(change_2018_2019), total_2019_2020 = VALUES(total_2019_2020), total_2019 = VALUES(total_2019), endowment_total_2019_2020 = VALUES(endowment_total_2019_2020), endowment_total_2019 = VALUES(endowment_total_2019), all_funds_total_2019_2020 = VALUES(all_funds_total_2019_2020), all_funds_change_2019_2020 = VALUES(all_funds_change_2019_2020), change_2019_2020 = VALUES(change_2019_2020), total_2020_2021 = VALUES(total_2020_2021), total_2020 = VALUES(total_2020), endowment_total_2020_2021 = VALUES(endowment_total_2020_2021), endowment_total_2020 = VALUES(endowment_total_2020), all_funds_total_2020_2021 = VALUES(all_funds_total_2020_2021), all_funds_change_2020_2021 = VALUES(all_funds_change_2020_2021), endowment_change_2020_2021 = VALUES(endowment_change_2020_2021), change_2020_2021 = VALUES(change_2020_2021), total_2021_2022 = VALUES(total_2021_2022), total_2021 = VALUES(total_2021), endowment_total_2021_2022 = VALUES(endowment_total_2021_2022), endowment_total_2021 = VALUES(endowment_total_2021), all_funds_total_2021_2022 = VALUES(all_funds_total_2021_2022), all_funds_change_2021_2022 = VALUES(all_funds_change_2021_2022), endowment_change_2021_2022 = VALUES(endowment_change_2021_2022), change_2021_2022 = VALUES(change_2021_2022), total_2022_2023 = VALUES(total_2022_2023), total_2022 = VALUES(total_2022), endowment_total_2022_2023 = VALUES(endowment_total_2022_2023), endowment_total_2022 = VALUES(endowment_total_2022), all_funds_total_2022_2023 = VALUES(all_funds_total_2022_2023), all_funds_change_2022_2023 = VALUES(all_funds_change_2022_2023), endowment_change_2022_2023 = VALUES(endowment_change_2022_2023), change_2022_2023 = VALUES(change_2022_2023), total_2023_2024 = VALUES(total_2023_2024), total_2023 = VALUES(total_2023), endowment_total_2023_2024 = VALUES(endowment_total_2023_2024), endowment_total_2023 = VALUES(endowment_total_2023), all_funds_total_2023_2024 = VALUES(all_funds_total_2023_2024), all_funds_change_2023_2024 = VALUES(all_funds_change_2023_2024), endowment_change_2023_2024 = VALUES(endowment_change_2023_2024), change_2023_2024 = VALUES(change_2023_2024), total_2024_2025 = VALUES(total_2024_2025), total_2024 = VALUES(total_2024), endowment_total_2024_2025 = VALUES(endowment_total_2024_2025), endowment_total_2024 = VALUES(endowment_total_2024), all_funds_total_2024_2025 = VALUES(all_funds_total_2024_2025), all_funds_change_2024_2025 = VALUES(all_funds_change_2024_2025), endowment_change_2024_2025 = VALUES(endowment_change_2024_2025), change_2024_2025 = VALUES(change_2024_2025), total_2025_2026 = VALUES(total_2025_2026), total_2025 = VALUES(total_2025), endowment_total_2025_2026 = VALUES(endowment_total_2025_2026), endowment_total_2025 = VALUES(endowment_total_2025), all_funds_total_2025_2026 = VALUES(all_funds_total_2025_2026), all_funds_change_2025_2026 = VALUES(all_funds_change_2025_2026), endowment_change_2025_2026 = VALUES(endowment_change_2025_2026), change_2025_2026 = VALUES(change_2025_2026); END IF;  END //

CREATE TRIGGER civicrm_contribution_recur_after_update after update ON civicrm_contribution_recur FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //

CREATE TRIGGER civicrm_email_after_insert after insert ON civicrm_email FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_email_after_update after update ON civicrm_email FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_email_after_delete after delete ON civicrm_email FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //

CREATE TRIGGER civicrm_im_after_insert after insert ON civicrm_im FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_im_after_update after update ON civicrm_im FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_im_after_delete after delete ON civicrm_im FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //

CREATE TRIGGER civicrm_phone_after_insert after insert ON civicrm_phone FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_phone_before_insert before insert ON civicrm_phone FOR EACH ROW BEGIN  
SET NEW.phone_numeric = civicrm_strip_non_numeric(NEW.phone);
 END //

CREATE TRIGGER civicrm_phone_after_update after update ON civicrm_phone FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_phone_before_update before update ON civicrm_phone FOR EACH ROW BEGIN  
SET NEW.phone_numeric = civicrm_strip_non_numeric(NEW.phone);
 END //

CREATE TRIGGER civicrm_phone_after_delete after delete ON civicrm_phone FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //

CREATE TRIGGER civicrm_relationship_after_insert after insert ON civicrm_relationship FOR EACH ROW BEGIN  INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "a_b", rel.contact_id_a, reltype.name_a_b, rel.contact_id_b, reltype.name_b_a, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_a, near_relation = reltype.name_a_b, far_contact_id = rel.contact_id_b, far_relation = reltype.name_b_a, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;

INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "b_a", rel.contact_id_b, reltype.name_b_a, rel.contact_id_a, reltype.name_a_b, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_b, near_relation = reltype.name_b_a, far_contact_id = rel.contact_id_a, far_relation = reltype.name_a_b, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;
 END //

CREATE TRIGGER civicrm_relationship_after_update after update ON civicrm_relationship FOR EACH ROW BEGIN  INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "a_b", rel.contact_id_a, reltype.name_a_b, rel.contact_id_b, reltype.name_b_a, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_a, near_relation = reltype.name_a_b, far_contact_id = rel.contact_id_b, far_relation = reltype.name_b_a, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;

INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "b_a", rel.contact_id_b, reltype.name_b_a, rel.contact_id_a, reltype.name_a_b, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_b, near_relation = reltype.name_b_a, far_contact_id = rel.contact_id_a, far_relation = reltype.name_a_b, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;
 END //

CREATE TRIGGER civicrm_relationship_type_after_update after update ON civicrm_relationship_type FOR EACH ROW BEGIN  
IF ((OLD.name_a_b != NEW.name_a_b COLLATE utf8mb4_bin) OR (OLD.name_b_a != NEW.name_b_a COLLATE utf8mb4_bin)) THEN
 INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "a_b", rel.contact_id_a, reltype.name_a_b, rel.contact_id_b, reltype.name_b_a, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.relationship_type_id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_a, near_relation = reltype.name_a_b, far_contact_id = rel.contact_id_b, far_relation = reltype.name_b_a, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;
 END IF;


IF ((OLD.name_a_b != NEW.name_a_b COLLATE utf8mb4_bin) OR (OLD.name_b_a != NEW.name_b_a COLLATE utf8mb4_bin)) THEN
 INSERT INTO civicrm_relationship_cache (relationship_id, relationship_type_id, orientation, near_contact_id, near_relation, far_contact_id, far_relation, start_date, end_date, is_active, case_id)
SELECT rel.id, rel.relationship_type_id, "b_a", rel.contact_id_b, reltype.name_b_a, rel.contact_id_a, reltype.name_a_b, rel.start_date, rel.end_date, rel.is_active, rel.case_id
FROM civicrm_relationship rel
INNER JOIN civicrm_relationship_type reltype ON rel.relationship_type_id = reltype.id
WHERE (rel.relationship_type_id = NEW.id)
 ON DUPLICATE KEY UPDATE relationship_type_id = rel.relationship_type_id, near_contact_id = rel.contact_id_b, near_relation = reltype.name_b_a, far_contact_id = rel.contact_id_a, far_relation = reltype.name_a_b, start_date = rel.start_date, end_date = rel.end_date, is_active = rel.is_active, case_id = rel.case_id
;
 END IF;
 END //

CREATE TRIGGER civicrm_value_1_communication_4_after_insert after insert ON civicrm_value_1_communication_4 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_1_communication_4_after_update after update ON civicrm_value_1_communication_4 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_1_communication_4_after_delete after delete ON civicrm_value_1_communication_4 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_1_prospect_5_after_insert after insert ON civicrm_value_1_prospect_5 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_1_prospect_5_after_update after update ON civicrm_value_1_prospect_5 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_1_prospect_5_after_delete after delete ON civicrm_value_1_prospect_5 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_anonymous__after_insert after insert ON civicrm_value_anonymous_ FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_anonymous__after_update after update ON civicrm_value_anonymous_ FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_anonymous__after_delete after delete ON civicrm_value_anonymous_ FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_assistant_15_after_insert after insert ON civicrm_value_assistant_15 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_assistant_15_after_update after update ON civicrm_value_assistant_15 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_assistant_15_after_delete after delete ON civicrm_value_assistant_15 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_endowment_yea_28_after_insert after insert ON civicrm_value_endowment_yea_28 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_endowment_yea_28_after_update after update ON civicrm_value_endowment_yea_28 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_endowment_yea_28_after_delete after delete ON civicrm_value_endowment_yea_28 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_major_gifts_y_27_after_insert after insert ON civicrm_value_major_gifts_y_27 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_major_gifts_y_27_after_update after update ON civicrm_value_major_gifts_y_27 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_major_gifts_y_27_after_delete after delete ON civicrm_value_major_gifts_y_27 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_matching_gift_after_insert after insert ON civicrm_value_matching_gift FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_matching_gift_after_update after update ON civicrm_value_matching_gift FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_matching_gift_after_delete after delete ON civicrm_value_matching_gift FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_organization_contact_14_after_insert after insert ON civicrm_value_organization_contact_14 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_organization_contact_14_after_update after update ON civicrm_value_organization_contact_14 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_organization_contact_14_after_delete after delete ON civicrm_value_organization_contact_14 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_partner_19_after_insert after insert ON civicrm_value_partner_19 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_partner_19_after_update after update ON civicrm_value_partner_19 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_partner_19_after_delete after delete ON civicrm_value_partner_19 FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_pg_commitment_25_after_insert after insert ON civicrm_value_pg_commitment_25 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_pg_commitment_25_after_update after update ON civicrm_value_pg_commitment_25 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_pg_commitment_25_after_delete after delete ON civicrm_value_pg_commitment_25 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_value_pg_inquiry_ac_26_after_insert after insert ON civicrm_value_pg_inquiry_ac_26 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_pg_inquiry_ac_26_after_update after update ON civicrm_value_pg_inquiry_ac_26 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //

CREATE TRIGGER civicrm_value_pg_inquiry_ac_26_after_delete after delete ON civicrm_value_pg_inquiry_ac_26 FOR EACH ROW BEGIN  UPDATE civicrm_activity SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //

CREATE TRIGGER civicrm_website_after_insert after insert ON civicrm_website FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_website_after_update after update ON civicrm_website FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.contact_id; END //

CREATE TRIGGER civicrm_website_after_delete after delete ON civicrm_website FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.contact_id; END //
DROP TRIGGER IF EXISTS wmf_donor_after_insert //

CREATE TRIGGER wmf_donor_after_insert after insert ON wmf_donor FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //
DROP TRIGGER IF EXISTS wmf_donor_after_update //

CREATE TRIGGER wmf_donor_after_update after update ON wmf_donor FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = NEW.entity_id; END //
DROP TRIGGER IF EXISTS wmf_donor_after_delete //

CREATE TRIGGER wmf_donor_after_delete after delete ON wmf_donor FOR EACH ROW BEGIN  UPDATE civicrm_contact SET modified_date = CURRENT_TIMESTAMP WHERE id = OLD.entity_id; END //
DELIMITER ;
